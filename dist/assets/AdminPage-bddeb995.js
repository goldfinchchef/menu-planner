import{r as w,j as e,a as Ut,R as ss,L as ts,u as qt}from"./index-4baa199c.js";import{U as Cs,i as ws,Z as He,j as Ds,k as Oe,f as Ss,d as Ps,c as Fs,e as Ts,C as Rs,h as Ws,l as Ht,F as _t,S as Vt}from"./index-93416efa.js";import{c as ke,C as as,T as ls,a as pe,A as Ve,P as $s,M as Yt}from"./truck-139681aa.js";import{E as ns,C as _e,R as rs,U as Ls}from"./utensils-0f69ef6f.js";import{W as Zt,d as We,T as Fe,X as fe,a as os,b as cs,P as Ne,A as Kt,U as Bs,D as Gs,i as qe,R as Jt,e as Xt,o as Qt,p as ea,c as sa,l as ta,C as aa,s as zs,n as Ge}from"./RecipesTab-efc7fa84.js";import{H as la}from"./home-124d23bd.js";import{C as Es,P as na}from"./pen-line-1aa29ab1.js";const Ms=ke("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),ra=ke("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),Ye=ke("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),oa=ke("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]),ca=ke("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]),ia=ke("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),da=ke("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]),Us=ke("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1-2-1Z",key:"wqdwcb"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17V7",key:"pyj7ub"}]]),As=ke("Repeat",[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]]),qs=ke("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),$e=ke("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);function ma({clients:n,weeklyTasks:x={},setWeeklyTasks:j,clientPortalData:Q={}}){const T=new Date,$=T.toLocaleDateString("en-US",{weekday:"long"}),H=(()=>{const m=new Date(T),D=m.getDay(),I=m.getDate()-D+(D===0?-6:1);return m.setDate(I),m.toISOString().split("T")[0]})(),X=new Date(new Date(H).getTime()+6*24*60*60*1e3).toLocaleDateString("en-US",{month:"short",day:"numeric"}),te=new Date(H).toLocaleDateString("en-US",{month:"short",day:"numeric"}),[q,K]=w.useState({}),h=x[H]||q,O=(m,D,I)=>{const y={...h,[m]:{...h[m]||{},[D]:I}};j?j({...x,[H]:y}):K(y)},ie=(m,D)=>{O(m,"honeybookLink",D)},ce=m=>{const D=m.startDate?new Date(m.startDate):new Date(2024,0,1);return Math.floor((T-D)/(7*24*60*60*1e3))%4+1},ae=[],N=[],R=[];n.forEach(m=>{if(m.status==="paused")R.push(m);else if(m.status==="active"){const D=ce(m);D===4&&ae.push({...m,weekNumber:D}),(m.frequency==="weekly"||m.frequency==="biweekly"&&Math.floor(T.getTime()/6048e5)%2===0)&&N.push(m)}});const p=[];Object.entries(Q).forEach(([m,D])=>{if(D.substitutionRequest){const I=n.find(y=>y.name===m);p.push({clientName:m,displayName:(I==null?void 0:I.displayName)||m,...D.substitutionRequest})}});const B=()=>{let m=0,D=ae.length*5;return ae.forEach(I=>{var y,J,t,r,o;(y=h[I.name])!=null&&y.invoicePrepared&&m++,(J=h[I.name])!=null&&J.honeybookLink&&m++,(t=h[I.name])!=null&&t.reminderSent&&m++,(r=h[I.name])!=null&&r.invoicePaid&&m++,(o=h[I.name])!=null&&o.datesSelected&&m++}),{completed:m,total:D}},_=()=>{let m=0,D=N.length*2;return N.forEach(I=>{var y,J;(y=h[I.name])!=null&&y.menusPlanned&&m++,(J=h[I.name])!=null&&J.menusSent&&m++}),{completed:m,total:D}},A=B(),W=_(),E={completed:A.completed+W.completed+p.filter(m=>{var D;return(D=h[m.clientName])==null?void 0:D.substitutionHandled}).length,total:A.total+W.total+p.length},le=[{key:"deliveringThisWeek",title:"Delivering This Week",icon:ls,color:"#27ae60",clients:N},{key:"paused",title:"Paused",icon:da,color:"#9b59b6",clients:R}],xe=({client:m})=>e.jsx("div",{className:"border-2 rounded-lg p-3 bg-white",style:{borderColor:"#ebb582"},children:e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold",children:m.displayName||m.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[m.persons," persons • ",m.mealsPerWeek," meals/week • ",m.frequency]}),m.deliveryDay&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Delivery: ",m.deliveryDay]}),m.zone&&e.jsxs("span",{className:"inline-block mt-1 px-2 py-0.5 text-xs rounded bg-blue-100 text-blue-800",children:["Zone ",m.zone]})]})})});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",style:{color:"#3d59ab"},children:"Weekly Tasks"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-gray-600",children:["Today is ",$]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Week of ",te," - ",X]}),e.jsxs("p",{className:"text-lg font-bold",style:{color:E.completed===E.total&&E.total>0?"#27ae60":"#3d59ab"},children:[E.completed," / ",E.total," complete"]})]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 mt-4",children:e.jsx("div",{className:"h-3 rounded-full transition-all duration-300",style:{width:`${E.total>0?E.completed/E.total*100:0}%`,backgroundColor:E.completed===E.total&&E.total>0?"#27ae60":"#3d59ab"}})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ye,{size:24,style:{color:"#e74c3c"}}),e.jsx("h3",{className:"text-xl font-bold",style:{color:"#e74c3c"},children:"Billing & Renewals"})]}),e.jsxs("span",{className:"px-3 py-1 rounded text-sm font-medium",style:{backgroundColor:A.completed===A.total&&A.total>0?"#e8f8f0":"#fde8e8",color:A.completed===A.total&&A.total>0?"#27ae60":"#e74c3c"},children:[A.completed,"/",A.total]})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Week 4 clients due for renewal"}),ae.length===0?e.jsx("p",{className:"text-gray-500 italic",children:"No clients in Week 4 this week"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-2 pr-4",children:"Client"}),e.jsx("th",{className:"text-center py-2 px-2",children:"Invoice Prepared"}),e.jsx("th",{className:"text-center py-2 px-2",children:"Honeybook Link"}),e.jsx("th",{className:"text-center py-2 px-2",children:"Reminder Sent"}),e.jsx("th",{className:"text-center py-2 px-2",children:"Invoice Paid"}),e.jsx("th",{className:"text-center py-2 px-2",children:"Dates Selected"})]})}),e.jsx("tbody",{children:ae.map(m=>{var D,I,y,J,t,r,o;return e.jsxs("tr",{className:"border-b border-gray-100",children:[e.jsxs("td",{className:"py-3 pr-4",children:[e.jsx("p",{className:"font-medium",children:m.displayName||m.name}),e.jsx("p",{className:"text-xs text-gray-500",children:m.frequency})]}),e.jsx("td",{className:"text-center py-3 px-2",children:e.jsx("input",{type:"checkbox",checked:((D=h[m.name])==null?void 0:D.invoicePrepared)||!1,onChange:u=>O(m.name,"invoicePrepared",u.target.checked),className:"w-5 h-5 rounded cursor-pointer",style:{accentColor:"#e74c3c"}})}),e.jsx("td",{className:"text-center py-3 px-2",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"text",value:((I=h[m.name])==null?void 0:I.honeybookLink)||m.honeyBookLink||"",onChange:u=>ie(m.name,u.target.value),placeholder:"Paste link...",className:"w-24 p-1 text-xs border rounded"}),(((y=h[m.name])==null?void 0:y.honeybookLink)||m.honeyBookLink)&&e.jsx("a",{href:((J=h[m.name])==null?void 0:J.honeybookLink)||m.honeyBookLink,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600",children:e.jsx(ns,{size:14})})]})}),e.jsx("td",{className:"text-center py-3 px-2",children:e.jsx("input",{type:"checkbox",checked:((t=h[m.name])==null?void 0:t.reminderSent)||!1,onChange:u=>O(m.name,"reminderSent",u.target.checked),className:"w-5 h-5 rounded cursor-pointer",style:{accentColor:"#e74c3c"}})}),e.jsx("td",{className:"text-center py-3 px-2",children:e.jsx("input",{type:"checkbox",checked:((r=h[m.name])==null?void 0:r.invoicePaid)||!1,onChange:u=>O(m.name,"invoicePaid",u.target.checked),className:"w-5 h-5 rounded cursor-pointer",style:{accentColor:"#27ae60"}})}),e.jsx("td",{className:"text-center py-3 px-2",children:e.jsx("input",{type:"checkbox",checked:((o=h[m.name])==null?void 0:o.datesSelected)||!1,onChange:u=>O(m.name,"datesSelected",u.target.checked),className:"w-5 h-5 rounded cursor-pointer",style:{accentColor:"#3d59ab"}})})]},m.name)})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(as,{size:24,style:{color:"#27ae60"}}),e.jsx("h3",{className:"text-xl font-bold",style:{color:"#27ae60"},children:"Menu Planning"})]}),e.jsxs("span",{className:"px-3 py-1 rounded text-sm font-medium",style:{backgroundColor:(W.completed===W.total&&W.total>0,"#e8f8f0"),color:(W.completed===W.total&&W.total>0,"#27ae60")},children:[W.completed,"/",W.total]})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Clients with deliveries this week"}),N.length===0?e.jsx("p",{className:"text-gray-500 italic",children:"No deliveries scheduled this week"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-2 pr-4",children:"Client"}),e.jsx("th",{className:"text-center py-2 px-2",children:"Menus Planned"}),e.jsx("th",{className:"text-center py-2 px-2",children:"Menus Sent"})]})}),e.jsx("tbody",{children:N.map(m=>{var D,I;return e.jsxs("tr",{className:"border-b border-gray-100",children:[e.jsxs("td",{className:"py-3 pr-4",children:[e.jsx("p",{className:"font-medium",children:m.displayName||m.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[m.persons,"p • ",m.mealsPerWeek," meals • ",m.deliveryDay||"No day set"]})]}),e.jsx("td",{className:"text-center py-3 px-2",children:e.jsx("input",{type:"checkbox",checked:((D=h[m.name])==null?void 0:D.menusPlanned)||!1,onChange:y=>O(m.name,"menusPlanned",y.target.checked),className:"w-5 h-5 rounded cursor-pointer",style:{accentColor:"#27ae60"}})}),e.jsx("td",{className:"text-center py-3 px-2",children:e.jsx("input",{type:"checkbox",checked:((I=h[m.name])==null?void 0:I.menusSent)||!1,onChange:y=>O(m.name,"menusSent",y.target.checked),className:"w-5 h-5 rounded cursor-pointer",style:{accentColor:"#27ae60"}})})]},m.name)})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(As,{size:24,style:{color:"#f39c12"}}),e.jsx("h3",{className:"text-xl font-bold",style:{color:"#f39c12"},children:"Substitution Requests"})]}),p.length>0&&e.jsxs("span",{className:"px-3 py-1 rounded text-sm font-medium",style:{backgroundColor:"#fef3c7",color:"#f39c12"},children:[p.filter(m=>{var D;return(D=h[m.clientName])==null?void 0:D.substitutionHandled}).length,"/",p.length]})]}),p.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsx(As,{size:32,className:"mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-gray-500 italic",children:"No substitution requests this week"})]}):e.jsx("div",{className:"space-y-3",children:p.map((m,D)=>{var I,y,J;return e.jsx("div",{className:`border-2 rounded-lg p-4 ${(I=h[m.clientName])!=null&&I.substitutionHandled?"bg-green-50 border-green-200":"border-amber-200 bg-amber-50"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:"font-bold",children:m.displayName}),((y=h[m.clientName])==null?void 0:y.substitutionHandled)&&e.jsx("span",{className:"text-xs px-2 py-1 rounded bg-green-100 text-green-700",children:"Handled"})]}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500",children:"Instead of:"})," ",e.jsx("span",{className:"font-medium",children:m.originalDish})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500",children:"Requested:"})," ",e.jsx("span",{className:"font-medium",children:m.requestedSubstitution})]}),m.submittedAt&&e.jsxs("p",{className:"text-xs text-gray-400",children:["Submitted: ",new Date(m.submittedAt).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})]})]})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((J=h[m.clientName])==null?void 0:J.substitutionHandled)||!1,onChange:t=>O(m.clientName,"substitutionHandled",t.target.checked),className:"w-5 h-5 rounded",style:{accentColor:"#27ae60"}}),e.jsx("span",{className:"text-sm",children:"Handled"})]})]})},D)})})]}),le.map(({key:m,title:D,icon:I,color:y,clients:J})=>e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(I,{size:24,style:{color:y}}),e.jsxs("h3",{className:"text-xl font-bold",style:{color:y},children:[D," (",J.length,")"]})]}),J.length===0?e.jsx("p",{className:"text-gray-500 italic",children:"No clients in this category"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:J.map((t,r)=>e.jsx(xe,{client:t},r))})]},m))]})}function Is({client:n,date:x,menuItems:j}){const Q=new Date(x+"T12:00:00").toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}).toUpperCase(),T=[];j.forEach(P=>{const H={protein:P.protein,sides:[P.veg,P.starch].filter(Boolean)};(H.protein||H.sides.length>0)&&T.push(H),P.extras&&P.extras.forEach(X=>{T.push({protein:X,sides:[],isExtra:!0})})});const $=n.displayName||n.name;return e.jsxs("div",{className:"overflow-hidden shadow-lg rounded-lg",style:{backgroundColor:"#fff"},children:[e.jsxs("div",{className:"relative px-4 pt-6 pb-8",style:{backgroundColor:"#f9f9ed",backgroundImage:"url(/pattern4.png)",backgroundSize:"cover",backgroundPosition:"center"},children:[e.jsx("p",{className:"text-center mb-2",style:{fontFamily:'"Glacial Indifference", sans-serif',fontSize:"12px",letterSpacing:"0.3em",color:"#5a5a5a"},children:"GOLDFINCH CHEF SERVICES"}),e.jsxs("h2",{className:"text-center mb-3",style:{color:"#3d59ab",fontFamily:'"Poller One", cursive',fontSize:"18px",textTransform:"uppercase",letterSpacing:"0.05em",textDecoration:"underline",textDecorationColor:"#3d59ab",textUnderlineOffset:"4px"},children:[$,"'s Menu"]}),e.jsx("p",{className:"text-center mb-4",style:{color:"#5a5a5a",fontFamily:'"Beth Ellen", cursive',fontSize:"12px"},children:"here's what to expect on your plate!"}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("img",{src:"/goldfinch5.png",alt:"Goldfinch",className:"w-12 h-12 object-contain"}),e.jsx("p",{style:{fontFamily:'"Glacial Indifference", sans-serif',fontSize:"14px",letterSpacing:"0.2em",color:"#5a5a5a"},children:Q})]})]}),e.jsx("div",{className:"px-6 py-8",style:{backgroundColor:"#d9a87a"},children:e.jsxs("div",{className:"space-y-8",children:[T.map((P,H)=>e.jsxs("div",{className:"text-center",children:[P.protein&&e.jsx("h3",{style:{color:"#ffffff",fontFamily:'"Glacial Indifference", sans-serif',fontSize:"1.1rem",fontWeight:"bold",letterSpacing:"0.15em",textTransform:"uppercase",marginBottom:P.sides.length>0?"0.5rem":0},children:P.protein}),P.sides.length>0&&e.jsx("p",{style:{color:"#f5e6d3",fontFamily:'"Glacial Indifference", sans-serif',fontSize:"0.85rem",letterSpacing:"0.1em",textTransform:"uppercase"},children:P.sides.join(", ")})]},H)),T.length===0&&e.jsx("p",{className:"text-center text-white/70 italic",children:"No menu items yet"})]})}),e.jsxs("div",{className:"relative px-6 py-6",style:{backgroundColor:"#f9f9ed",fontFamily:'"Glacial Indifference", sans-serif'},children:[e.jsx("h4",{className:"mb-3",style:{color:"#3d59ab",fontFamily:'"Poller One", cursive',fontSize:"1.1rem",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Get Ready!"}),e.jsx("p",{className:"mb-4 pr-20",style:{color:"#5a5a5a",fontSize:"0.9rem",lineHeight:"1.5"},children:"Remember to put out bags, containers, and ice packs. And get excited – great food is on the way!"}),e.jsx("img",{src:"/stemflower.png",alt:"",className:"absolute right-4 bottom-4 h-20 object-contain"})]})]})}function xa({menuDate:n,setMenuDate:x,clients:j,allClients:Q,selectedClients:T,setSelectedClients:$,recipes:P,newMenuItem:H,setNewMenuItem:X,menuItems:te,setMenuItems:q,addMenuItem:K,clearMenu:h,deleteMenuItem:O,getOrdersByClient:ie,clientPortalData:ce={},weeklyTasks:ae={},weeks:N={},selectedWeekId:R,setSelectedWeekId:p,lockWeekAndSnapshot:B,unlockWeekById:_}){const[A,W]=w.useState(null),[E,le]=w.useState(null),[xe,m]=w.useState(!0),D=N==null?void 0:N[R],I=(D==null?void 0:D.status)==="locked",y=(Q||j||[]).filter(d=>d.status==="active"),J=d=>{if(!d)return null;const S=new Date(d+"T12:00:00"),U=S.getDay(),ue=S.getDate()-U+(U===0?-6:1),de=new Date(S);return de.setDate(ue),de.toISOString().split("T")[0]},t=te.filter(d=>J(d.date)===R),o=(()=>{const d=new Date,S=d.getDay(),U=d.getDate()-S+(S===0?-6:1);return d.setDate(U),d.toISOString().split("T")[0]})();ae[o];const u=d=>{const S=d.displayName||d.name,U=t.filter(we=>we.clientName===S),ue=U.length>0,de=ue&&U.every(we=>we.approved);let Y=null;if(d.billDueDate){const we=new Date(d.billDueDate+"T12:00:00"),he=Math.floor((new Date-we)/(1e3*60*60*24));he>=1&&(Y=`Invoice overdue (${he} day${he>1?"s":""})`)}return(!d.deliveryDates||d.deliveryDates.length===0)&&(Y=Y||"Delivery dates not set"),ue?de?{status:"approved",icon:pe,color:"text-green-600",bg:"bg-green-50",warning:Y}:Y?{status:"warning",icon:Ve,color:"text-amber-600",bg:"bg-amber-50",warning:Y}:{status:"pending",icon:Ms,color:"text-blue-600",bg:"bg-blue-50",warning:Y}:{status:"none",icon:Ms,color:"text-gray-400",bg:"bg-gray-50",warning:Y}},c=()=>y.filter(d=>t.some(U=>{const ue=d.displayName||d.name;return U.clientName===ue})),G=()=>{const d={};return t.forEach(S=>{d[S.clientName]||(d[S.clientName]=[]),d[S.clientName].push(S)}),d},L=d=>{q(S=>S.map(U=>U.clientName===d?{...U,approved:!0}:U))},v=()=>{const d=y.filter(S=>{S.displayName||S.name;const U=u(S);return U.status==="pending"&&!U.warning});if(d.length===0){alert("No menus ready to approve");return}d.forEach(S=>{const U=S.displayName||S.name;L(U)}),alert(`Approved ${d.length} menu(s)`)},i=d=>{window.confirm(`Remove all menu items for ${d}?`)&&(q(S=>S.filter(U=>U.clientName!==d)),W(null))},k=(d,S)=>{if(S.every(he=>he.approved)&&I){alert("This menu is approved and the week is locked. Unlock the week first to make edits.");return}const ue=y.find(he=>(he.displayName||he.name)===d)||y.find(he=>he.name===d),de=(ue==null?void 0:ue.name)||d,Y=S[0],we=S.flatMap(he=>he.extras||[]),Ce=[...new Set(we)];X({protein:(Y==null?void 0:Y.protein)||"",veg:(Y==null?void 0:Y.veg)||"",starch:(Y==null?void 0:Y.starch)||"",extras:Ce}),x((Y==null?void 0:Y.date)||n),$([de]),le(d),m(!0),q(he=>he.filter(Le=>Le.clientName!==d))},f=()=>{le(null),X({protein:"",veg:"",starch:"",extras:[]}),$([])},b=d=>t.filter(S=>S.clientName===d),se=d=>{X(S=>({...S,extras:S.extras.includes(d)?S.extras.filter(U=>U!==d):[...S.extras,d]}))},V=[...P.sauces||[],...P.breakfast||[],...P.soups||[]],z=G();return c(),y.filter(d=>u(d).status==="approved").length,y.filter(d=>u(d).status==="pending").length,y.filter(d=>u(d).warning).length,y.filter(d=>u(d).status==="none").length,e.jsxs("div",{className:"space-y-6",children:[N&&R&&p&&e.jsx(Zt,{selectedWeekId:R,setSelectedWeekId:p,weeks:N,onLockWeek:B,onUnlockWeek:_}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-2xl font-bold",style:{color:"#3d59ab"},children:"Delivering This Week"}),t.filter(d=>!d.approved).length>0&&e.jsx("button",{onClick:v,className:"px-4 py-2 rounded-lg text-white font-medium text-sm",style:{backgroundColor:"#10b981"},children:"Approve All Ready"})]}),y.length>0?e.jsx("div",{className:"flex flex-wrap gap-x-1 gap-y-1 text-sm",children:y.map((d,S)=>{const U=d.displayName||d.name,ue=t.some(Y=>Y.clientName===U),de=ue&&t.filter(Y=>Y.clientName===U).every(Y=>Y.approved);return e.jsxs("span",{className:"inline-flex items-center",children:[ue&&e.jsx(pe,{size:14,className:de?"text-green-600 mr-0.5":"text-blue-500 mr-0.5"}),e.jsx("span",{className:ue?de?"text-green-700 font-medium":"text-blue-600":"text-gray-500",children:U}),S<y.length-1&&e.jsx("span",{className:"text-gray-300 mx-1",children:","})]},S)})}):e.jsx("p",{className:"text-gray-500",children:"No active clients"})]}),t.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold",style:{color:"#3d59ab"},children:["Current Orders (",Object.keys(z).length," clients)"]}),t.some(d=>!d.approved)&&e.jsxs("button",{onClick:v,className:"flex items-center gap-2 px-4 py-2 rounded-lg text-white text-sm",style:{backgroundColor:"#22c55e"},children:[e.jsx(pe,{size:16})," Approve All"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Object.entries(z).map(([d,S])=>{var de;const U=S.every(Y=>Y.approved),ue=y.find(Y=>(Y.displayName||Y.name)===d)||y.find(Y=>Y.name===d)||{name:d,displayName:d};return e.jsxs("div",{className:"flex flex-col",children:[e.jsx(Is,{client:ue,date:((de=S[0])==null?void 0:de.date)||n,menuItems:S}),e.jsxs("div",{className:"mt-3 flex items-center justify-between p-3 rounded-lg",style:{backgroundColor:"#f9f9ed"},children:[e.jsx("div",{className:"flex items-center gap-2",children:U?e.jsxs("span",{className:"text-sm text-green-700 flex items-center gap-1 font-medium",children:[e.jsx(pe,{size:16})," Approved"]}):e.jsx("span",{className:"text-sm text-blue-600",children:"Pending approval"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[!U&&e.jsxs("button",{onClick:()=>L(d),className:"flex items-center gap-1 px-3 py-1.5 rounded text-sm text-white",style:{backgroundColor:"#22c55e"},children:[e.jsx(pe,{size:14})," Approve"]}),e.jsxs("button",{onClick:()=>k(d,S),className:`flex items-center gap-1 px-3 py-1.5 rounded text-sm ${U&&I?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-100 text-blue-700 hover:bg-blue-200"}`,title:U&&I?"Unlock week to edit approved menu":"Edit menu",children:[e.jsx(We,{size:14})," Edit"]}),e.jsxs("button",{onClick:()=>i(d),className:"flex items-center gap-1 px-3 py-1.5 rounded text-sm bg-red-100 text-red-700",children:[e.jsx(Fe,{size:14})," Remove"]})]})]})]},d)})})]}),e.jsxs("div",{className:`bg-white rounded-lg shadow-lg p-6 ${E?"ring-2 ring-blue-500":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-xl font-bold",style:{color:"#3d59ab"},children:E?`Editing: ${E}`:"Build Menu"}),E&&e.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-blue-100 text-blue-700",children:"Editing Mode"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[E&&e.jsxs("button",{onClick:f,className:"flex items-center gap-1 px-3 py-1 rounded-lg text-sm bg-gray-200 text-gray-700 hover:bg-gray-300",children:[e.jsx(fe,{size:14})," Cancel Edit"]}),e.jsxs("button",{onClick:()=>m(!xe),className:"flex items-center gap-2 px-3 py-1 rounded-lg text-sm text-gray-600 hover:bg-gray-100",children:[xe?e.jsx(os,{size:16}):e.jsx(cs,{size:16}),xe?"Collapse":"Expand"]})]})]}),xe&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#423d3c"},children:"Menu Date"}),e.jsx("input",{type:"date",value:n,onChange:d=>x(d.target.value),className:"w-full p-2 border-2 rounded-lg",style:{borderColor:"#ebb582"}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#423d3c"},children:"Select Clients"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:y.map((d,S)=>e.jsx("button",{onClick:()=>$(U=>U.includes(d.name)?U.filter(ue=>ue!==d.name):[...U,d.name]),className:`px-2 py-1 rounded-full border text-xs transition-colors ${T.includes(d.name)?"text-white":"bg-white"}`,style:T.includes(d.name)?{backgroundColor:"#3d59ab",borderColor:"#3d59ab"}:{borderColor:"#ebb582",color:"#423d3c"},children:d.displayName||d.name},S))})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:["protein","veg","starch"].map(d=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 capitalize",style:{color:"#423d3c"},children:d==="veg"?"Vegetable":d}),e.jsxs("select",{value:H[d],onChange:S=>X({...H,[d]:S.target.value}),className:"w-full p-2 border-2 rounded-lg",style:{borderColor:"#ebb582"},children:[e.jsx("option",{value:"",children:"Select..."}),(P[d]||[]).map((S,U)=>e.jsx("option",{value:S.name,children:S.name},U))]})]},d))}),V.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#423d3c"},children:"Extras (Sauces, Breakfast, Soups)"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:V.map((d,S)=>e.jsx("button",{onClick:()=>se(d.name),className:`px-3 py-1 rounded-full border-2 transition-colors text-sm ${H.extras.includes(d.name)?"text-white":"bg-white"}`,style:H.extras.includes(d.name)?{backgroundColor:"#ebb582",borderColor:"#ebb582"}:{borderColor:"#ebb582",color:"#423d3c"},children:d.name},S))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{K(),E&&le(null)},className:"flex items-center gap-2 px-6 py-2 rounded-lg hover:opacity-90",style:{backgroundColor:E?"#3d59ab":"#ffd700",color:E?"#fff":"#423d3c"},children:E?e.jsxs(e.Fragment,{children:[e.jsx(pe,{size:20}),"Save Changes"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{size:20}),"Add to Menu"]})}),E&&e.jsxs("button",{onClick:f,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-gray-200 text-gray-700",children:[e.jsx(fe,{size:16}),"Cancel"]}),!E&&te.length>0&&e.jsxs("button",{onClick:h,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-red-100 text-red-700 text-sm",children:[e.jsx(Fe,{size:16}),"Clear All"]})]})]})]}),A&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-lg w-full max-h-[90vh] overflow-auto",children:[e.jsxs("div",{className:"p-4 border-b flex items-center justify-between sticky top-0 bg-white",children:[e.jsx("h3",{className:"text-lg font-bold",style:{color:"#3d59ab"},children:"Menu Preview"}),e.jsx("button",{onClick:()=>W(null),className:"p-1 rounded hover:bg-gray-100",children:e.jsx(fe,{size:20})})]}),e.jsx("div",{className:"p-4",children:e.jsx(Is,{client:A,date:n,menuItems:b(A.displayName||A.name)})}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-2 sticky bottom-0 bg-white",children:[e.jsx("button",{onClick:()=>i(A.displayName||A.name),className:"px-4 py-2 rounded-lg bg-red-100 text-red-700",children:"Remove Menu"}),e.jsxs("button",{onClick:()=>{const d=A.displayName||A.name,S=b(d);k(d,S),W(null)},className:"px-4 py-2 rounded-lg border-2 flex items-center gap-2",style:{borderColor:"#3d59ab",color:"#3d59ab"},children:[e.jsx(We,{size:18})," Edit"]}),e.jsxs("button",{onClick:()=>{L(A.displayName||A.name),W(null)},className:"px-4 py-2 rounded-lg text-white flex items-center gap-2",style:{backgroundColor:"#22c55e"},children:[e.jsx(pe,{size:18})," Approve"]})]})]})})]})}function pa({masterIngredients:n,newIngredient:x,setNewIngredient:j,editingIngredientId:Q,editingIngredientData:T,setEditingIngredientData:$,duplicateWarnings:P,setDuplicateWarnings:H,scanForDuplicates:X,mergeIngredients:te,addMasterIngredient:q,deleteMasterIngredient:K,startEditingMasterIngredient:h,saveEditingMasterIngredient:O,cancelEditingMasterIngredient:ie,ingredientsFileRef:ce,exportIngredientsCSV:ae}){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",style:{color:"#3d59ab"},children:"Ingredients"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:X,className:"flex items-center gap-2 px-4 py-2 rounded-lg border-2 border-orange-400 text-orange-600",children:[e.jsx(Kt,{size:18}),"Find Duplicates"]}),e.jsxs("button",{onClick:()=>ce.current.click(),className:"flex items-center gap-2 px-4 py-2 rounded-lg border-2",style:{borderColor:"#3d59ab",color:"#3d59ab"},children:[e.jsx(Bs,{size:18}),"Import"]}),e.jsxs("button",{onClick:ae,className:"flex items-center gap-2 px-4 py-2 rounded-lg text-white",style:{backgroundColor:"#3d59ab"},children:[e.jsx(Gs,{size:18}),"Export"]})]})]}),P.length>0&&e.jsxs("div",{className:"mb-4 p-4 bg-orange-50 border-2 border-orange-200 rounded-lg",children:[e.jsx("h3",{className:"font-bold text-orange-700 mb-2",children:"Duplicates:"}),P.map((N,R)=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-orange-200 last:border-0",children:[e.jsxs("span",{className:"text-sm",children:['"',N.ing1.name,'" ↔ "',N.ing2.name,'"']}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>te(N.ing1.id,N.ing2.id),className:"text-xs px-2 py-1 rounded bg-blue-100 text-blue-700",children:['Keep "',N.ing1.name,'"']}),e.jsxs("button",{onClick:()=>te(N.ing2.id,N.ing1.id),className:"text-xs px-2 py-1 rounded bg-blue-100 text-blue-700",children:['Keep "',N.ing2.name,'"']}),e.jsx("button",{onClick:()=>H(p=>p.filter((B,_)=>_!==R)),className:"text-xs px-2 py-1 rounded bg-gray-100",children:"Ignore"})]})]},R))]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsx("input",{type:"text",value:x.name,onChange:N=>j({...x,name:N.target.value}),placeholder:"Name",className:"p-2 border-2 rounded-lg",style:{borderColor:"#ebb582"}}),e.jsx("input",{type:"text",value:x.cost,onChange:N=>j({...x,cost:N.target.value}),placeholder:"Cost/unit",className:"p-2 border-2 rounded-lg",style:{borderColor:"#ebb582"}}),e.jsx("select",{value:x.unit,onChange:N=>j({...x,unit:N.target.value}),className:"p-2 border-2 rounded-lg",style:{borderColor:"#ebb582"},children:Cs.map(N=>e.jsx("option",{value:N,children:N},N))}),e.jsx("input",{type:"text",value:x.source,onChange:N=>j({...x,source:N.target.value}),placeholder:"Source",className:"p-2 border-2 rounded-lg",style:{borderColor:"#ebb582"}}),e.jsx("select",{value:x.section,onChange:N=>j({...x,section:N.target.value}),className:"p-2 border-2 rounded-lg",style:{borderColor:"#ebb582"},children:ws.map(N=>e.jsx("option",{value:N,children:N},N))})]}),e.jsxs("button",{onClick:q,className:"px-6 py-2 rounded-lg text-white",style:{backgroundColor:"#3d59ab"},children:[e.jsx(Ne,{size:20,className:"inline mr-2"}),"Add"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-4",style:{color:"#3d59ab"},children:["All Ingredients (",n.length,")"]}),n.length>0?e.jsx("div",{className:"space-y-2",children:n.map(N=>e.jsx("div",{children:Q===N.id?e.jsxs("div",{className:"flex flex-wrap gap-2 p-3 rounded-lg border-2",style:{borderColor:"#3d59ab",backgroundColor:"#f9f9ed"},children:[e.jsx("input",{type:"text",value:T.name,onChange:R=>$({...T,name:R.target.value}),className:"flex-1 min-w-[120px] p-2 border rounded"}),e.jsx("input",{type:"text",value:T.cost,onChange:R=>$({...T,cost:R.target.value}),placeholder:"$",className:"w-16 p-2 border rounded"}),e.jsx("select",{value:T.unit,onChange:R=>$({...T,unit:R.target.value}),className:"w-16 p-2 border rounded",children:Cs.map(R=>e.jsx("option",{value:R,children:R},R))}),e.jsx("input",{type:"text",value:T.source,onChange:R=>$({...T,source:R.target.value}),placeholder:"Source",className:"w-20 p-2 border rounded"}),e.jsx("select",{value:T.section,onChange:R=>$({...T,section:R.target.value}),className:"w-28 p-2 border rounded",children:ws.map(R=>e.jsx("option",{value:R,children:R},R))}),e.jsx("button",{onClick:O,className:"px-3 py-2 rounded text-white",style:{backgroundColor:"#3d59ab"},children:e.jsx(pe,{size:18})}),e.jsx("button",{onClick:ie,className:"px-3 py-2 rounded bg-gray-200",children:e.jsx(fe,{size:18})})]}):e.jsxs("div",{className:"flex justify-between items-center p-3 rounded-lg",style:{backgroundColor:"#f9f9ed"},children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:N.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[N.cost&&`$${N.cost}/${N.unit}`," ",N.source&&`• ${N.source}`," • ",N.section]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>h(N),className:"text-blue-600",children:e.jsx(We,{size:18})}),e.jsx("button",{onClick:()=>K(N.id),className:"text-red-600",children:e.jsx(Fe,{size:18})})]})]})},N.id))}):e.jsx("p",{className:"text-gray-500",children:"No ingredients yet."})]})]})}const ne=({label:n,children:x})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium mb-1",style:{color:"#423d3c"},children:n}),x]}),re="p-2 border-2 rounded-lg",oe={borderColor:"#ebb582"},Os=({contact:n,index:x,onChange:j,onRemove:Q,canRemove:T})=>e.jsxs("div",{className:"p-4 rounded-lg border-2 relative",style:{borderColor:"#d9a87a",backgroundColor:"#fff"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"text-sm font-bold",style:{color:"#3d59ab"},children:["Contact ",x+1]}),T&&e.jsx("button",{type:"button",onClick:Q,className:"text-red-500 hover:text-red-700 p-1",title:"Remove contact",children:e.jsx(ia,{size:18})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx(ne,{label:"Full Name",children:e.jsx("input",{type:"text",value:n.fullName||"",onChange:$=>j(x,"fullName",$.target.value),placeholder:"Full name",className:re,style:oe})}),e.jsx(ne,{label:"Display Name (for greetings)",children:e.jsx("input",{type:"text",value:n.displayName||"",onChange:$=>j(x,"displayName",$.target.value),placeholder:"e.g., Jennifer",className:re,style:oe})}),e.jsx(ne,{label:"Email",children:e.jsx("input",{type:"email",value:n.email||"",onChange:$=>j(x,"email",$.target.value),placeholder:"Email address",className:re,style:oe})}),e.jsx(ne,{label:"Phone",children:e.jsx("input",{type:"tel",value:n.phone||"",onChange:$=>j(x,"phone",$.target.value),placeholder:"Phone number",className:re,style:oe})}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(ne,{label:"Delivery Address",children:e.jsx("input",{type:"text",value:n.address||"",onChange:$=>j(x,"address",$.target.value),placeholder:"Street address",className:re,style:oe})})})]})]}),Ue=n=>{if(n.subscriptionId)return n;const x=n.contacts&&n.contacts.length>0?n.contacts.map(j=>({fullName:j.fullName||j.name||"",displayName:j.displayName||"",email:j.email||"",phone:j.phone||"",address:j.address||""})):[{fullName:n.name||"",displayName:"",email:n.email||"",phone:n.phone||"",address:n.address||""}];return{subscriptionId:n.id||Date.now().toString(),displayName:n.displayName||n.name||"",portions:n.portions||n.persons||1,mealsPerWeek:n.mealsPerWeek||0,frequency:n.frequency||"weekly",status:n.status||"active",zone:n.zone||"",deliveryDay:n.deliveryDay||"",pickup:n.pickup||!1,planPrice:n.planPrice||0,serviceFee:n.serviceFee||0,prepayDiscount:n.prepayDiscount||!1,newClientFeePaid:n.newClientFeePaid||!1,paysOwnGroceries:n.paysOwnGroceries||!1,billingNotes:n.billingNotes||"",accessCode:n.accessCode||"",honeyBookLink:n.honeyBookLink||"",contacts:x}};function ua({clients:n,newClient:x,setNewClient:j,addClient:Q,deleteClient:T,clientsFileRef:$,exportClientsCSV:P,setClients:H,deliveryLog:X=[],orderHistory:te=[]}){const[q,K]=w.useState(null),[h,O]=w.useState(null),[ie,ce]=w.useState({}),ae=t=>{ce(r=>({...r,[t]:!r[t]}))},N=t=>{const r=X.filter(c=>c.clientName===t).map(c=>({date:c.date,dishes:[],status:c.problem?"problem":"delivered",problem:c.problem,bagsReturned:c.bagsReturned,source:"log"})),o=te.filter(c=>c.clientName===t).map(c=>({date:c.date,dishes:c.dishes||[],status:"completed",source:"history"})),u={};return[...r,...o].forEach(c=>{(!u[c.date]||c.dishes.length>0)&&(u[c.date]=c)}),Object.values(u).sort((c,G)=>new Date(G.date)-new Date(c.date)).slice(0,4)},R=t=>t.contacts&&t.contacts.length>0?t.contacts:[{...Oe}],p=t=>{const r=Ue(n[t]);K(t),O({...r,contacts:R(r)})},B=()=>{K(null),O(null)},_=()=>{const t=[...n];t[q]=h,H(t),K(null),O(null)},A=(t,r,o)=>{const u=[...x.contacts||[{...Oe}]];u[t]={...u[t],[r]:o},j({...x,contacts:u})},W=()=>{const t=[...x.contacts||[],{...Oe}];j({...x,contacts:t})},E=t=>{const r=(x.contacts||[]).filter((o,u)=>u!==t);j({...x,contacts:r})},le=(t,r,o)=>{const u=[...h.contacts];u[t]={...u[t],[r]:o},O({...h,contacts:u})},xe=()=>{const t=[...h.contacts,{...Oe}];O({...h,contacts:t})},m=t=>{const r=h.contacts.filter((o,u)=>u!==t);O({...h,contacts:r})},D=t=>{const r=(t.subscriptionId||t.displayName||t.name||"").toString().toLowerCase().replace(/\s+/g,"-");return`${window.location.origin}/client/${r}`},I=t=>{const r=D(t);navigator.clipboard.writeText(r).then(()=>{alert(`Portal link copied!
${r}`)}).catch(()=>{prompt("Copy this link:",r)})},y=t=>{const r=R(Ue(t)),o=[...new Set(r.filter(u=>u.address).map(u=>u.address.toLowerCase().trim()))];return{count:r.length,uniqueAddresses:o.length,contacts:r,primaryContact:r[0]}},J=()=>{const t=["subscriptionId","subscriptionDisplayName","portions","mealsPerWeek","frequency","status","zone","deliveryDay","pickup","planPrice","serviceFee","prepayDiscount","newClientFeePaid","paysOwnGroceries","billingNotes","accessCode","contactFullName","contactDisplayName","email","phone","address"],r=[];n.forEach(L=>{const v=Ue(L);R(v).forEach((k,f)=>{r.push([f===0?v.subscriptionId:"",f===0?v.displayName:"",f===0?v.portions:"",f===0?v.mealsPerWeek:"",f===0?v.frequency:"",f===0?v.status:"",f===0?v.zone:"",f===0?v.deliveryDay:"",f===0?v.pickup:"",f===0?v.planPrice:"",f===0?v.serviceFee:"",f===0?v.prepayDiscount:"",f===0?v.newClientFeePaid:"",f===0?v.paysOwnGroceries:"",f===0?v.billingNotes:"",f===0?v.accessCode:"",k.fullName||"",k.displayName||"",k.email||"",k.phone||"",k.address||""].map(b=>`"${(b||"").toString().replace(/"/g,'""')}"`).join(","))})});const o=[t.join(","),...r].join(`
`),u=new Blob([o],{type:"text/csv"}),c=URL.createObjectURL(u),G=document.createElement("a");G.href=c,G.download="subscriptions.csv",G.click()};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",style:{color:"#3d59ab"},children:"Add Subscription"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{var t;return(t=$.current)==null?void 0:t.click()},className:"flex items-center gap-2 px-4 py-2 rounded-lg border-2",style:{borderColor:"#3d59ab",color:"#3d59ab"},children:[e.jsx(Bs,{size:18}),"Import"]}),e.jsxs("button",{onClick:J,className:"flex items-center gap-2 px-4 py-2 rounded-lg text-white",style:{backgroundColor:"#3d59ab"},children:[e.jsx(Gs,{size:18}),"Export"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(ne,{label:"Subscription Name",children:e.jsx("input",{type:"text",value:x.displayName||"",onChange:t=>j({...x,displayName:t.target.value}),placeholder:"e.g., J.J. and Lauren",className:re,style:oe})}),e.jsx(ne,{label:"Portions",children:e.jsx("input",{type:"number",value:x.portions||1,onChange:t=>j({...x,portions:parseInt(t.target.value)||1}),placeholder:"Number of portions",className:re,style:oe})}),e.jsx(ne,{label:"Meals per Week",children:e.jsx("input",{type:"number",value:x.mealsPerWeek||0,onChange:t=>j({...x,mealsPerWeek:parseInt(t.target.value)||0}),placeholder:"Number of meals",className:re,style:oe})}),e.jsx(ne,{label:"Zone",children:e.jsxs("select",{value:x.zone||"",onChange:t=>j({...x,zone:t.target.value}),className:re,style:oe,children:[e.jsx("option",{value:"",children:"Unassigned"}),He.map(t=>e.jsxs("option",{value:t,children:["Zone ",t]},t))]})}),e.jsx(ne,{label:"Delivery Day",children:e.jsxs("select",{value:x.deliveryDay||"",onChange:t=>j({...x,deliveryDay:t.target.value}),className:re,style:oe,children:[e.jsx("option",{value:"",children:"Select day"}),Ds.map(t=>e.jsx("option",{value:t,children:t},t))]})}),e.jsx(ne,{label:"Frequency",children:e.jsxs("select",{value:x.frequency||"weekly",onChange:t=>j({...x,frequency:t.target.value}),className:re,style:oe,children:[e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"biweekly",children:"Biweekly"})]})}),e.jsx(ne,{label:"Status",children:e.jsxs("select",{value:x.status||"active",onChange:t=>j({...x,status:t.target.value}),className:re,style:oe,children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"paused",children:"Paused"})]})}),e.jsx(ne,{label:"Client Portal Access Code",children:e.jsx("input",{type:"text",value:x.accessCode||"",onChange:t=>j({...x,accessCode:t.target.value}),placeholder:"Optional access code",className:re,style:oe})}),e.jsxs("div",{className:"flex items-center gap-2 pt-6",children:[e.jsx("input",{type:"checkbox",id:"pickup",checked:x.pickup||!1,onChange:t=>j({...x,pickup:t.target.checked,serviceFee:t.target.checked?0:x.serviceFee}),className:"w-5 h-5 rounded border-2",style:{accentColor:"#3d59ab"}}),e.jsx("label",{htmlFor:"pickup",className:"text-sm font-medium",style:{color:"#423d3c"},children:"Pickup (exclude from delivery routes)"})]}),e.jsx(ne,{label:"Menu Selection",children:e.jsxs("select",{value:x.chefChoice===!1?"client":"chef",onChange:t=>j({...x,chefChoice:t.target.value==="chef"}),className:re,style:oe,children:[e.jsx("option",{value:"chef",children:"Chef Choice (Chef Paula picks)"}),e.jsx("option",{value:"client",children:"Client Picks (Client selects dishes)"})]})}),e.jsx(ne,{label:"HoneyBook Invoice Link",children:e.jsx("input",{type:"url",value:x.honeyBookLink||"",onChange:t=>j({...x,honeyBookLink:t.target.value}),className:re,style:oe,placeholder:"https://..."})})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t-2",style:{borderColor:"#ebb582"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",style:{color:"#3d59ab"},children:[e.jsx($e,{size:20}),"Contacts"]}),e.jsxs("button",{type:"button",onClick:W,className:"flex items-center gap-1 px-3 py-1 rounded-lg text-white text-sm",style:{backgroundColor:"#3d59ab"},children:[e.jsx(Ne,{size:16}),"Add Contact"]})]}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Each contact receives notifications. Different addresses = separate delivery stops."}),e.jsx("div",{className:"space-y-4",children:(x.contacts||[{...Oe}]).map((t,r)=>e.jsx(Os,{contact:t,index:r,onChange:A,onRemove:()=>E(r),canRemove:(x.contacts||[]).length>1},r))})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t-2",style:{borderColor:"#ebb582"},children:[e.jsx("h3",{className:"text-lg font-bold mb-4",style:{color:"#3d59ab"},children:"Pricing"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(ne,{label:"Plan Price ($)",children:e.jsx("input",{type:"number",step:"0.01",value:x.planPrice||0,onChange:t=>j({...x,planPrice:parseFloat(t.target.value)||0}),placeholder:"0.00",className:re,style:oe})}),e.jsx(ne,{label:"Service Fee ($)",children:e.jsx("input",{type:"number",step:"0.01",value:x.pickup?0:x.serviceFee||0,onChange:t=>j({...x,serviceFee:parseFloat(t.target.value)||0}),placeholder:"0.00",className:re,style:oe,disabled:x.pickup})}),e.jsxs("div",{className:"flex items-center gap-2 pt-6",children:[e.jsx("input",{type:"checkbox",id:"prepayDiscount",checked:x.prepayDiscount||!1,onChange:t=>j({...x,prepayDiscount:t.target.checked}),className:"w-5 h-5 rounded border-2",style:{accentColor:"#3d59ab"}}),e.jsx("label",{htmlFor:"prepayDiscount",className:"text-sm font-medium",style:{color:"#423d3c"},children:"Pre-pay Discount (10% off)"})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-6",children:[e.jsx("input",{type:"checkbox",id:"newClientFeePaid",checked:x.newClientFeePaid||!1,onChange:t=>j({...x,newClientFeePaid:t.target.checked}),className:"w-5 h-5 rounded border-2",style:{accentColor:"#3d59ab"}}),e.jsx("label",{htmlFor:"newClientFeePaid",className:"text-sm font-medium",style:{color:"#423d3c"},children:"New Client Fee Paid"})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsx("input",{type:"checkbox",id:"paysOwnGroceries",checked:x.paysOwnGroceries||!1,onChange:t=>j({...x,paysOwnGroceries:t.target.checked}),className:"w-5 h-5 rounded border-2",style:{accentColor:"#3d59ab"}}),e.jsx("label",{htmlFor:"paysOwnGroceries",className:"text-sm font-medium",style:{color:"#423d3c"},children:"Pays Own Groceries"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(ne,{label:"Billing Notes",children:e.jsx("textarea",{value:x.billingNotes||"",onChange:t=>j({...x,billingNotes:t.target.value}),placeholder:"Any billing notes",className:re+" w-full",style:oe,rows:"2"})})})]}),e.jsxs("button",{onClick:Q,className:"mt-6 px-6 py-2 rounded-lg text-white",style:{backgroundColor:"#3d59ab"},children:[e.jsx(Ne,{size:20,className:"inline mr-2"}),"Add Subscription"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-4",style:{color:"#3d59ab"},children:["Subscriptions (",n.length,")"]}),e.jsx("div",{className:"space-y-3",children:n.map((t,r)=>{var u;const o=Ue(t);return e.jsx("div",{children:q===r?e.jsxs("div",{className:"border-2 rounded-lg p-4",style:{borderColor:"#3d59ab",backgroundColor:"#f9f9ed"},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(ne,{label:"Subscription Name",children:e.jsx("input",{type:"text",value:h.displayName||"",onChange:c=>O({...h,displayName:c.target.value}),className:re,style:oe})}),e.jsx(ne,{label:"Portions",children:e.jsx("input",{type:"number",value:h.portions||1,onChange:c=>O({...h,portions:parseInt(c.target.value)||1}),className:re,style:oe})}),e.jsx(ne,{label:"Meals per Week",children:e.jsx("input",{type:"number",value:h.mealsPerWeek||0,onChange:c=>O({...h,mealsPerWeek:parseInt(c.target.value)||0}),className:re,style:oe})}),e.jsx(ne,{label:"Zone",children:e.jsxs("select",{value:h.zone||"",onChange:c=>O({...h,zone:c.target.value}),className:re,style:oe,children:[e.jsx("option",{value:"",children:"Unassigned"}),He.map(c=>e.jsxs("option",{value:c,children:["Zone ",c]},c))]})}),e.jsx(ne,{label:"Delivery Day",children:e.jsxs("select",{value:h.deliveryDay||"",onChange:c=>O({...h,deliveryDay:c.target.value}),className:re,style:oe,children:[e.jsx("option",{value:"",children:"Select day"}),Ds.map(c=>e.jsx("option",{value:c,children:c},c))]})}),e.jsx(ne,{label:"Frequency",children:e.jsxs("select",{value:h.frequency||"weekly",onChange:c=>O({...h,frequency:c.target.value}),className:re,style:oe,children:[e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"biweekly",children:"Biweekly"})]})}),e.jsx(ne,{label:"Status",children:e.jsxs("select",{value:h.status||"active",onChange:c=>O({...h,status:c.target.value}),className:re,style:oe,children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"paused",children:"Paused"})]})}),e.jsx(ne,{label:"Access Code",children:e.jsx("input",{type:"text",value:h.accessCode||"",onChange:c=>O({...h,accessCode:c.target.value}),className:re,style:oe})}),e.jsxs("div",{className:"flex items-center gap-2 pt-6",children:[e.jsx("input",{type:"checkbox",id:`pickup-edit-${r}`,checked:h.pickup||!1,onChange:c=>O({...h,pickup:c.target.checked,serviceFee:c.target.checked?0:h.serviceFee}),className:"w-5 h-5 rounded border-2",style:{accentColor:"#3d59ab"}}),e.jsx("label",{htmlFor:`pickup-edit-${r}`,className:"text-sm font-medium",style:{color:"#423d3c"},children:"Pickup"})]}),e.jsx(ne,{label:"Menu Selection",children:e.jsxs("select",{value:h.chefChoice===!1?"client":"chef",onChange:c=>O({...h,chefChoice:c.target.value==="chef"}),className:re,style:oe,children:[e.jsx("option",{value:"chef",children:"Chef Choice (Chef Paula picks)"}),e.jsx("option",{value:"client",children:"Client Picks (Client selects dishes)"})]})}),e.jsx(ne,{label:"HoneyBook Invoice Link",children:e.jsx("input",{type:"url",value:h.honeyBookLink||"",onChange:c=>O({...h,honeyBookLink:c.target.value}),className:re,style:oe,placeholder:"https://..."})})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t-2",style:{borderColor:"#ebb582"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"text-md font-bold flex items-center gap-2",style:{color:"#3d59ab"},children:[e.jsx($e,{size:18}),"Contacts (",((u=h.contacts)==null?void 0:u.length)||1,")"]}),e.jsxs("button",{type:"button",onClick:xe,className:"flex items-center gap-1 px-3 py-1 rounded-lg text-white text-sm",style:{backgroundColor:"#3d59ab"},children:[e.jsx(Ne,{size:16}),"Add Contact"]})]}),e.jsx("div",{className:"space-y-4",children:(h.contacts||[]).map((c,G)=>e.jsx(Os,{contact:c,index:G,onChange:le,onRemove:()=>m(G),canRemove:h.contacts.length>1},G))})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t-2",style:{borderColor:"#ebb582"},children:[e.jsx("h4",{className:"text-md font-bold mb-3",style:{color:"#3d59ab"},children:"Pricing"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(ne,{label:"Plan Price ($)",children:e.jsx("input",{type:"number",step:"0.01",value:h.planPrice||0,onChange:c=>O({...h,planPrice:parseFloat(c.target.value)||0}),className:re,style:oe})}),e.jsx(ne,{label:"Service Fee ($)",children:e.jsx("input",{type:"number",step:"0.01",value:h.pickup?0:h.serviceFee||0,onChange:c=>O({...h,serviceFee:parseFloat(c.target.value)||0}),className:re,style:oe,disabled:h.pickup})}),e.jsxs("div",{className:"flex items-center gap-2 pt-6",children:[e.jsx("input",{type:"checkbox",id:`prepayDiscount-edit-${r}`,checked:h.prepayDiscount||!1,onChange:c=>O({...h,prepayDiscount:c.target.checked}),className:"w-5 h-5 rounded border-2",style:{accentColor:"#3d59ab"}}),e.jsx("label",{htmlFor:`prepayDiscount-edit-${r}`,className:"text-sm font-medium",style:{color:"#423d3c"},children:"Pre-pay (10% off)"})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-6",children:[e.jsx("input",{type:"checkbox",id:`newClientFeePaid-edit-${r}`,checked:h.newClientFeePaid||!1,onChange:c=>O({...h,newClientFeePaid:c.target.checked}),className:"w-5 h-5 rounded border-2",style:{accentColor:"#3d59ab"}}),e.jsx("label",{htmlFor:`newClientFeePaid-edit-${r}`,className:"text-sm font-medium",style:{color:"#423d3c"},children:"New Client Fee Paid"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:`paysOwnGroceries-edit-${r}`,checked:h.paysOwnGroceries||!1,onChange:c=>O({...h,paysOwnGroceries:c.target.checked}),className:"w-5 h-5 rounded border-2",style:{accentColor:"#3d59ab"}}),e.jsx("label",{htmlFor:`paysOwnGroceries-edit-${r}`,className:"text-sm font-medium",style:{color:"#423d3c"},children:"Pays Own Groceries"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(ne,{label:"Billing Notes",children:e.jsx("textarea",{value:h.billingNotes||"",onChange:c=>O({...h,billingNotes:c.target.value}),className:re+" w-full",style:oe,rows:"2"})})})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs("button",{onClick:_,className:"flex items-center gap-1 px-4 py-2 rounded-lg text-white",style:{backgroundColor:"#3d59ab"},children:[e.jsx(pe,{size:18}),"Save"]}),e.jsxs("button",{onClick:B,className:"flex items-center gap-1 px-4 py-2 rounded-lg bg-gray-200",children:[e.jsx(fe,{size:18}),"Cancel"]})]})]}):e.jsx("div",{className:`border-2 rounded-lg p-4 ${o.status==="paused"?"opacity-60":""}`,style:{borderColor:o.status==="paused"?"#9ca3af":"#ebb582"},children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h3",{className:"font-bold text-lg",children:o.displayName||"Unnamed"}),o.status==="paused"&&e.jsx("span",{className:"text-xs px-2 py-1 rounded bg-gray-200 text-gray-600",children:"Paused"}),o.status==="active"&&e.jsx("span",{className:"text-xs px-2 py-1 rounded bg-green-100 text-green-700",children:"Active"}),o.pickup&&e.jsx("span",{className:"text-xs px-2 py-1 rounded bg-blue-100 text-blue-700",children:"Pickup"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[o.portions," portions • ",o.mealsPerWeek," meals/week • ",o.frequency==="biweekly"?"Biweekly":"Weekly"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[o.zone?`Zone ${o.zone}`:"No zone",o.deliveryDay&&` • ${o.deliveryDay}`]}),(()=>{const{count:c,uniqueAddresses:G,contacts:L}=y(o);return e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("span",{className:"text-purple-600 font-medium",children:[e.jsx($e,{size:14,className:"inline mr-1"}),c," contact",c!==1?"s":""," • ",G," delivery stop",G!==1?"s":""]}),e.jsx("div",{className:"mt-1 space-y-1",children:L.map((v,i)=>e.jsxs("div",{className:"text-gray-500 pl-4 border-l-2",style:{borderColor:"#d9a87a"},children:[e.jsx("span",{className:"font-medium",children:v.fullName||v.displayName||`Contact ${i+1}`}),v.displayName&&v.displayName!==v.fullName&&e.jsxs("span",{className:"text-xs text-gray-400 ml-1",children:['"',v.displayName,'"']}),v.address&&e.jsx("span",{className:"block text-xs",children:v.address})]},i))})]})})})(),o.billingNotes&&e.jsxs("p",{className:"text-sm text-amber-700 mt-2 bg-amber-50 px-2 py-1 rounded",children:["Billing: ",o.billingNotes]}),(()=>{const c=o.subscriptionId||o.displayName||r,G=o.displayName||o.name,L=N(G),v=ie[c];return L.length===0?null:e.jsxs("div",{className:"mt-3",children:[e.jsxs("button",{onClick:i=>{i.stopPropagation(),ae(c)},className:"flex items-center gap-1 text-sm text-gray-600 hover:text-gray-800",children:[e.jsx(ls,{size:14}),e.jsxs("span",{children:["Recent Deliveries (",L.length,")"]}),v?e.jsx(os,{size:14}):e.jsx(cs,{size:14})]}),v&&e.jsx("div",{className:"mt-2 pl-4 border-l-2 space-y-2",style:{borderColor:"#3d59ab"},children:L.map((i,k)=>e.jsxs("div",{className:"text-sm p-2 rounded",style:{backgroundColor:"#f9f9ed"},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:new Date(i.date+"T12:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}),i.status==="problem"&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded bg-red-100 text-red-700",children:i.problem}),i.status==="delivered"&&!i.problem&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded bg-green-100 text-green-700",children:"Delivered"}),i.bagsReturned===!1&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded bg-amber-100 text-amber-700",children:"No bags"})]}),i.dishes&&i.dishes.length>0&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:i.dishes.join(", ")})]},k))})]})})()]}),e.jsxs("div",{className:"flex gap-2 self-start ml-4",children:[e.jsx("button",{onClick:()=>I(o),className:"text-purple-600",title:"Copy portal link",children:e.jsx(ca,{size:18})}),e.jsx("button",{onClick:()=>p(r),className:"text-blue-600",title:"Edit",children:e.jsx(We,{size:18})}),e.jsx("button",{onClick:()=>T(r),className:"text-red-600",title:"Delete",children:e.jsx(Fe,{size:18})})]})]})})},o.subscriptionId||r)})})]})]})}function ha({client:n,clientPortalData:x={},onSave:j,onClose:Q}){var R;const[T,$]=w.useState((n==null?void 0:n.deliveryDates)||[]),[P,H]=w.useState((n==null?void 0:n.billDueDate)||""),[X,te]=w.useState(""),q=((R=x[n==null?void 0:n.name])==null?void 0:R.selectedDates)||[],K=q.length>0;w.useEffect(()=>{var p;((p=n==null?void 0:n.deliveryDates)==null?void 0:p.length)>0?$(n.deliveryDates):K&&$(q),H((n==null?void 0:n.billDueDate)||"")},[n]);const h=()=>{if(!X)return;if(T.includes(X)){alert("This date is already added");return}if(T.length>=4){alert("Maximum 4 delivery dates allowed");return}const p=[...T,X].sort();$(p),te("")},O=p=>{$(T.filter(B=>B!==p))},ie=()=>{q.length>0&&$([...q].sort())},ce=()=>{j({...n,deliveryDates:T.sort(),billDueDate:P}),Q()},ae=p=>p?new Date(p+"T12:00:00").toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}):"",N=(n==null?void 0:n.displayName)||(n==null?void 0:n.name)||"Unknown";return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b flex items-center justify-between",style:{backgroundColor:"#f9f9ed"},children:[e.jsx("h2",{className:"text-xl font-bold",style:{color:"#3d59ab"},children:N}),e.jsx("button",{onClick:Q,className:"p-1 hover:bg-gray-200 rounded",children:e.jsx(fe,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"font-bold flex items-center gap-2",style:{color:"#3d59ab"},children:[e.jsx(_e,{size:20}),"Next Delivery Dates"]}),K&&e.jsxs("button",{onClick:ie,className:"text-sm flex items-center gap-1 px-2 py-1 rounded bg-purple-100 text-purple-700 hover:bg-purple-200",children:[e.jsx(rs,{size:14}),"Sync from Portal"]})]}),K&&e.jsxs("p",{className:"text-xs text-purple-600 mb-2",children:["Client selected dates in portal: ",q.map(p=>ae(p)).join(", ")]}),e.jsx("div",{className:"space-y-2 mb-3",children:T.length===0?e.jsx("p",{className:"text-gray-400 text-sm italic",children:"No delivery dates set"}):T.map((p,B)=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded border",style:{borderColor:"#ebb582",backgroundColor:"#fff"},children:[e.jsxs("span",{children:[e.jsxs("span",{className:"text-gray-400 text-sm mr-2",children:["#",B+1]}),ae(p)]}),e.jsx("button",{onClick:()=>O(p),className:"text-red-500 hover:text-red-700 p-1",children:e.jsx(Fe,{size:16})})]},p))}),T.length<4&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"date",value:X,onChange:p=>te(p.target.value),min:new Date().toISOString().split("T")[0],className:"flex-1 p-2 border-2 rounded-lg",style:{borderColor:"#ebb582"}}),e.jsx("button",{onClick:h,disabled:!X,className:"px-4 py-2 rounded-lg text-white disabled:opacity-50",style:{backgroundColor:"#3d59ab"},children:e.jsx(Ne,{size:20})})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold flex items-center gap-2 mb-3",style:{color:"#3d59ab"},children:[e.jsx(Ye,{size:20}),"Bill Due Date"]}),e.jsx("input",{type:"date",value:P,onChange:p=>H(p.target.value),className:"w-full p-2 border-2 rounded-lg",style:{borderColor:"#ebb582"}}),P&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Due: ",ae(P),new Date(P+"T12:00:00")<new Date&&e.jsx("span",{className:"text-red-600 ml-2 font-medium",children:"OVERDUE"})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Subscription Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Plan:"})," ",e.jsxs("span",{className:"font-medium",children:["$",(n==null?void 0:n.planPrice)||0]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Service Fee:"})," ",e.jsxs("span",{className:"font-medium",children:["$",(n==null?void 0:n.serviceFee)||0]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Frequency:"})," ",e.jsx("span",{className:"font-medium capitalize",children:(n==null?void 0:n.frequency)||"weekly"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Meals/Week:"})," ",e.jsx("span",{className:"font-medium",children:(n==null?void 0:n.mealsPerWeek)||0})]})]})]})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end gap-3",children:[e.jsx("button",{onClick:Q,className:"px-4 py-2 rounded-lg border-2 hover:bg-gray-50",style:{borderColor:"#ebb582"},children:"Cancel"}),e.jsx("button",{onClick:ce,className:"px-4 py-2 rounded-lg text-white",style:{backgroundColor:"#3d59ab"},children:"Save Changes"})]})]})})}const Re="goldfinchChefData";function ga(){const[n,x]=w.useState([]),[j,Q]=w.useState([]),[T,$]=w.useState([]),[P,H]=w.useState([]),[X,te]=w.useState([]),[q,K]=w.useState({}),[h,O]=w.useState([]),[ie,ce]=w.useState({routeStartAddress:""}),[ae,N]=w.useState([]),[R,p]=w.useState({}),[B,_]=w.useState({protein:[],veg:[],starch:[],sauces:[],breakfast:[],soups:[]}),[A,W]=w.useState([]),[E,le]=w.useState([]),[xe,m]=w.useState({}),[D,I]=w.useState(!1);w.useEffect(()=>{const b=()=>{const V=localStorage.getItem(Re);if(V)try{const z=JSON.parse(V);z.clients&&x(z.clients),z.drivers&&Q(z.drivers),z.menuItems&&$(z.menuItems),z.deliveryLog&&H(z.deliveryLog),z.readyForDelivery&&te(z.readyForDelivery),z.clientPortalData&&K(z.clientPortalData),z.blockedDates&&O(z.blockedDates),z.adminSettings&&ce(z.adminSettings),z.customTasks&&N(z.customTasks),z.weeklyTasks&&p(z.weeklyTasks),z.recipes&&_(z.recipes),z.masterIngredients&&W(z.masterIngredients),z.groceryBills&&le(z.groceryBills),z.weeks&&m(z.weeks)}catch(z){console.error("Error loading saved data:",z)}I(!0)};b();const se=V=>{V.key===Re&&b()};return window.addEventListener("storage",se),()=>window.removeEventListener("storage",se)},[]);const y=w.useCallback(b=>{const se=localStorage.getItem(Re);let V={};if(se)try{V=JSON.parse(se)}catch(d){console.error("Error parsing saved data:",d)}const z={...V,...b,lastSaved:new Date().toISOString()};localStorage.setItem(Re,JSON.stringify(z)),window.dispatchEvent(new CustomEvent("goldfinchDataUpdated"))},[]),J=w.useCallback(b=>{Q(b),y({drivers:b})},[y]),t=w.useCallback(b=>{O(b),y({blockedDates:b})},[y]),r=w.useCallback(b=>{ce(b),y({adminSettings:b})},[y]),o=w.useCallback(b=>{N(b),y({customTasks:b})},[y]),u=w.useCallback(b=>{if(typeof b=="function"){const se=localStorage.getItem(Re);let V=[];if(se)try{V=JSON.parse(se).menuItems||[]}catch(d){console.error("Error parsing saved data:",d)}const z=b(V);$(z),y({menuItems:z})}else $(b),y({menuItems:b})},[y]),c=w.useCallback(b=>{p(b),y({weeklyTasks:b})},[y]),G=w.useCallback(b=>{_(b),y({recipes:b})},[y]),L=w.useCallback(b=>{W(b),y({masterIngredients:b})},[y]),v=w.useCallback(b=>{x(b),y({clients:b})},[y]),i=w.useCallback(b=>{le(b),y({groceryBills:b})},[y]),k=w.useCallback(b=>{m(b),y({weeks:b})},[y]),f=w.useCallback(b=>{const se=xe[b]||sa(b);if(se.status==="locked")return se;const V=ta(se,T,n),z={...xe,[b]:V};return m(z),y({weeks:z}),V},[xe,T,n,y]);return{clients:n,drivers:j,menuItems:T,deliveryLog:P,readyForDelivery:X,clientPortalData:q,blockedDates:h,adminSettings:ie,customTasks:ae,weeklyTasks:R,recipes:B,masterIngredients:A,groceryBills:E,isLoaded:D,updateDrivers:J,updateBlockedDates:t,updateAdminSettings:r,updateMenuItems:u,updateWeeklyTasks:c,updateRecipes:G,updateMasterIngredients:L,updateCustomTasks:o,updateClients:v,updateGroceryBills:i,weeks:xe,updateWeeks:k,lockWeekWithSnapshot:f}}const ge=({label:n,children:x})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium mb-1",style:{color:"#423d3c"},children:n}),x]}),be="p-2 border-2 rounded-lg",ye={borderColor:"#ebb582"};function ba(n=new Date){const x=new Date(n);x.setDate(x.getDate()-x.getDay()),x.setHours(0,0,0,0);const j=new Date(x);return j.setDate(j.getDate()+6),j.setHours(23,59,59,999),{start:x,end:j}}function Ae(n){return new Date(n).toLocaleDateString("en-US",{month:"short",day:"numeric"})}function ya({weekStart:n,weekEnd:x,thisWeekDeliveries:j,thisWeekCompleted:Q,renewalsThisWeek:T,problemsThisWeek:$,autoTasks:P,customTasks:H,updateCustomTasks:X,newTask:te,setNewTask:q,addCustomTask:K,toggleTaskComplete:h,deleteCustomTask:O,groceryBills:ie,newGroceryBill:ce,setNewGroceryBill:ae,addGroceryBill:N,deleteGroceryBill:R,menuItems:p,recipes:B,getRecipeCost:_,clients:A,clientPortalData:W}){const[E,le]=w.useState(!1),[xe,m]=w.useState(!1),D=()=>{let i=0;return p.filter(f=>f.approved).forEach(f=>{const b=f.portions||1;["protein","veg","starch"].forEach(se=>{var V;if(f[se]){const z=(V=B[se])==null?void 0:V.find(d=>d.name===f[se]);z&&(i+=_(z)*b)}}),f.extras&&f.extras.forEach(se=>{const V=["sauces","breakfast","soups"].find(z=>{var d;return(d=B[z])==null?void 0:d.find(S=>S.name===se)});if(V){const z=B[V].find(d=>d.name===se);z&&(i+=_(z)*b)}})}),i},I=()=>{const i=new Date(n),k=new Date(x);return ie.filter(f=>{const b=new Date(f.date);return b>=i&&b<=k}).reduce((f,b)=>f+(b.amount||0),0)},y=()=>{const i={};return ie.forEach(k=>{const f=new Date(k.date),b=`${f.getFullYear()}-${String(f.getMonth()+1).padStart(2,"0")}`;i[b]||(i[b]={spending:0,calculated:0}),i[b].spending+=k.amount||0}),i},J=D(),t=I(),r=t-J,o=J>0?(r/J*100).toFixed(1):0,u=()=>{const i={},k=(f,b,se)=>{i[f]||(i[f]=[]);const V=H.some(z=>z.id===`${f}-${b}`&&z.completed);i[f].push({id:`${f}-${b}`,clientName:f,type:b,completed:V})};return P.forEach(f=>{var se;const b=((se=f.category)==null?void 0:se.toLowerCase())||"";b.includes("billing")||b.includes("renewal")?(f.details||[]).forEach(V=>{k(V,"Invoice prepared"),k(V,"Paste Honeybook link")}):b.includes("menu")?(f.details||[]).forEach(V=>{k(V,"Plan menu")}):b.includes("dish picks")||b.includes("client picks")?(f.details||[]).forEach(V=>{k(V,"Review dish picks")}):b.includes("substitution")?(f.details||[]).forEach(V=>{var d;const z=(d=V.split(":")[0])==null?void 0:d.trim();z&&k(z,"Review substitution request")}):b.includes("bags")?(f.details||[]).forEach(V=>{k(V,"Follow up on bags")}):b.includes("grocery")&&(f.details||[]).forEach(V=>{k(V,"Add grocery costs")})}),H.forEach(f=>{f.clientName&&(i[f.clientName]||(i[f.clientName]=[]),i[f.clientName].push({id:f.id,clientName:f.clientName,type:f.title,completed:f.completed,isCustom:!0}))}),i},c=()=>H.filter(i=>!i.clientName).map(i=>({...i,isCustom:!0})),G=u(),L=c(),v=Object.keys(G).length>0||L.length>0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",style:{color:"#3d59ab"},children:"This Week at a Glance"}),e.jsxs("p",{className:"text-gray-500 mb-6",children:[Ae(n)," - ",Ae(x)]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"#dbeafe"},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ls,{size:24,style:{color:"#3d59ab"}}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Pending"})]}),e.jsx("p",{className:"text-3xl font-bold",style:{color:"#3d59ab"},children:j.length}),e.jsx("p",{className:"text-sm text-gray-500",children:"deliveries"})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"#dcfce7"},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(pe,{size:24,className:"text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Completed"})]}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:Q.length}),e.jsx("p",{className:"text-sm text-gray-500",children:"deliveries"})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"#fef3c7"},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(rs,{size:24,className:"text-amber-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Renewals"})]}),e.jsx("p",{className:"text-3xl font-bold text-amber-600",children:T.length}),e.jsx("p",{className:"text-sm text-gray-500",children:"due"})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:$.length>0?"#fee2e2":"#f3f4f6"},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ve,{size:24,className:$.length>0?"text-red-600":"text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Problems"})]}),e.jsx("p",{className:`text-3xl font-bold ${$.length>0?"text-red-600":"text-gray-400"}`,children:$.length}),e.jsx("p",{className:"text-sm text-gray-500",children:"flagged"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",style:{color:"#3d59ab"},children:[e.jsx(aa,{size:28}),"To Do This Week"]}),e.jsxs("button",{onClick:()=>le(!E),className:"flex items-center gap-2 px-4 py-2 rounded-lg text-white",style:{backgroundColor:"#3d59ab"},children:[e.jsx(Ne,{size:18}),"Add Task"]})]}),E&&e.jsx("div",{className:"mb-4 p-4 rounded-lg border-2",style:{borderColor:"#ebb582",backgroundColor:"#f9f9ed"},children:e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("select",{value:te.clientName||"",onChange:i=>q({...te,clientName:i.target.value||void 0}),className:"p-2 border-2 rounded-lg",style:{borderColor:"#ebb582"},children:[e.jsx("option",{value:"",children:"Select client (optional)"}),A.filter(i=>i.status==="active").map((i,k)=>e.jsx("option",{value:i.displayName||i.name,children:i.displayName||i.name},k))]}),e.jsx("input",{type:"text",value:te.title,onChange:i=>q({...te,title:i.target.value}),placeholder:"Task description...",className:"flex-1 p-2 border-2 rounded-lg min-w-48",style:{borderColor:"#ebb582"}}),e.jsx("button",{onClick:()=>{K(),le(!1)},className:"px-4 py-2 rounded-lg text-white",style:{backgroundColor:"#3d59ab"},children:"Add"}),e.jsx("button",{onClick:()=>le(!1),className:"px-4 py-2 rounded-lg border-2",style:{borderColor:"#ebb582"},children:"Cancel"})]})}),e.jsx("div",{className:"space-y-4",children:v?e.jsxs(e.Fragment,{children:[Object.entries(G).map(([i,k])=>{const f=k.every(b=>b.completed);return e.jsxs("div",{className:`rounded-lg border-2 overflow-hidden ${f?"opacity-60":""}`,style:{borderColor:"#ebb582"},children:[e.jsx("div",{className:"px-4 py-2 font-bold",style:{backgroundColor:"#3d59ab",color:"white"},children:i}),e.jsx("div",{className:"p-3 space-y-2",style:{backgroundColor:"#f9f9ed"},children:k.map(b=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>{b.isCustom||H.find(V=>V.id===b.id)?h(b.id):X([...H,{...b,completed:!0}])},className:`w-5 h-5 rounded border-2 flex items-center justify-center flex-shrink-0 ${b.completed?"bg-green-500 border-green-500":"border-gray-300 bg-white hover:border-green-400"}`,children:b.completed&&e.jsx(pe,{size:12,className:"text-white"})}),e.jsx("span",{className:`text-sm ${b.completed?"line-through text-gray-400":""}`,children:b.type}),b.isCustom&&e.jsx("button",{onClick:()=>O(b.id),className:"text-red-400 hover:text-red-600 p-1 ml-auto",children:e.jsx(fe,{size:14})})]},b.id))})]},i)}),L.length>0&&e.jsxs("div",{className:"rounded-lg border-2 overflow-hidden",style:{borderColor:"#ebb582"},children:[e.jsx("div",{className:"px-4 py-2 font-bold",style:{backgroundColor:"#6b7280",color:"white"},children:"Other Tasks"}),e.jsx("div",{className:"p-3 space-y-2",style:{backgroundColor:"#f9f9ed"},children:L.map(i=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>h(i.id),className:`w-5 h-5 rounded border-2 flex items-center justify-center flex-shrink-0 ${i.completed?"bg-green-500 border-green-500":"border-gray-300 bg-white hover:border-green-400"}`,children:i.completed&&e.jsx(pe,{size:12,className:"text-white"})}),e.jsx("span",{className:`text-sm ${i.completed?"line-through text-gray-400":""}`,children:i.title}),e.jsx("button",{onClick:()=>O(i.id),className:"text-red-400 hover:text-red-600 p-1 ml-auto",children:e.jsx(fe,{size:14})})]},i.id))})]})]}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"All caught up! No tasks for this week."})})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",style:{color:"#3d59ab"},children:[e.jsx(Us,{size:24}),"Grocery Input"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("input",{type:"date",value:ce.date,onChange:i=>ae({...ce,date:i.target.value}),className:"p-2 border-2 rounded-lg text-sm",style:{borderColor:"#ebb582"}}),e.jsx("input",{type:"number",value:ce.amount,onChange:i=>ae({...ce,amount:i.target.value}),placeholder:"Amount",className:"p-2 border-2 rounded-lg text-sm",style:{borderColor:"#ebb582"}}),e.jsx("input",{type:"text",value:ce.store||"",onChange:i=>ae({...ce,store:i.target.value}),placeholder:"Store",className:"p-2 border-2 rounded-lg text-sm",style:{borderColor:"#ebb582"}})]}),e.jsx("button",{onClick:N,className:"w-full py-2 rounded-lg text-white",style:{backgroundColor:"#3d59ab"},children:"Add Bill"}),ie.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-2",children:"Recent Bills"}),e.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:ie.slice(-5).reverse().map(i=>{var k;return e.jsxs("div",{className:"flex justify-between items-center text-sm p-2 rounded",style:{backgroundColor:"#f9f9ed"},children:[e.jsxs("span",{children:[Ae(i.date)," - ",i.store||"N/A"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-medium",children:["$",(k=i.amount)==null?void 0:k.toFixed(2)]}),e.jsx("button",{onClick:()=>R(i.id),className:"text-red-500 hover:text-red-700",children:e.jsx(fe,{size:14})})]})]},i.id)})})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",style:{color:"#3d59ab"},children:[e.jsx(Ye,{size:24}),"Weekly Food Cost"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"#f9f9ed"},children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Calculated from Menu"}),e.jsxs("p",{className:"text-3xl font-bold",style:{color:"#3d59ab"},children:["$",J.toFixed(2)]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Based on approved menu items × portions"})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:t>0?"#dcfce7":"#f3f4f6"},children:[e.jsx("p",{className:"text-sm text-gray-600",children:"This Week's Spending"}),e.jsxs("p",{className:`text-3xl font-bold ${t>0?"text-green-600":"text-gray-400"}`,children:["$",t.toFixed(2)]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>m(!xe),className:"w-full p-4 flex justify-between items-center hover:bg-gray-50",children:[e.jsxs("h3",{className:"text-xl font-bold flex items-center gap-2",style:{color:"#3d59ab"},children:[e.jsx(qs,{size:24}),"Grocery Analysis"]}),e.jsx("span",{className:"text-2xl text-gray-400",children:xe?"−":"+"})]}),xe&&e.jsxs("div",{className:"p-6 pt-0 border-t",children:[e.jsxs("div",{className:"grid md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"#f9f9ed"},children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Actual Spending"}),e.jsxs("p",{className:"text-2xl font-bold",style:{color:"#3d59ab"},children:["$",t.toFixed(2)]})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"#f9f9ed"},children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Calculated Cost"}),e.jsxs("p",{className:"text-2xl font-bold",style:{color:"#3d59ab"},children:["$",J.toFixed(2)]})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:r>0?"#fee2e2":"#dcfce7"},children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Difference"}),e.jsxs("p",{className:`text-2xl font-bold ${r>0?"text-red-600":"text-green-600"}`,children:[r>0?"+":"","$",r.toFixed(2)]})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:parseFloat(o)>10?"#fee2e2":"#dcfce7"},children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Waste %"}),e.jsxs("p",{className:`text-2xl font-bold ${parseFloat(o)>10?"text-red-600":"text-green-600"}`,children:[o,"%"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold mb-3",style:{color:"#3d59ab"},children:"Monthly Trend"}),e.jsxs("div",{className:"space-y-2",children:[Object.entries(y()).sort((i,k)=>k[0].localeCompare(i[0])).slice(0,6).map(([i,k])=>{const b=new Date(i+"-01").toLocaleDateString("en-US",{month:"short",year:"numeric"});return e.jsxs("div",{className:"flex items-center gap-4 p-2 rounded",style:{backgroundColor:"#f9f9ed"},children:[e.jsx("span",{className:"w-24 text-sm font-medium",children:b}),e.jsx("div",{className:"flex-1 h-4 bg-gray-200 rounded overflow-hidden",children:e.jsx("div",{className:"h-full rounded",style:{width:`${Math.min(k.spending/1e3*100,100)}%`,backgroundColor:"#3d59ab"}})}),e.jsxs("span",{className:"w-24 text-right font-bold",children:["$",k.spending.toFixed(0)]})]},i)}),Object.keys(y()).length===0&&e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No grocery data yet"})]})]})]})]})]})}function fa({clients:n,updateClients:x,blockedDates:j,updateBlockedDates:Q}){const[T,$]=w.useState(new Date),[P,H]=w.useState(!1),X=new Date,te=n.filter(p=>p.status==="active"),q=n.filter(p=>p.status==="paused"),K=(p,B,_)=>{const A=n.map(W=>W.name===p?{...W,[B]:_}:W);x(A)},h=(p,B,_)=>{const W=[...n.find(le=>le.name===p).deliveryDates||["","","",""]];for(;W.length<4;)W.push("");W[B]=_;const E=W.filter(le=>le).sort();for(;E.length<4;)E.push("");K(p,"deliveryDates",E)},O=(p,B)=>{const _=n.map(A=>A.name===p?B?{...A,invoicePaid:!0,honeyBookLink:""}:{...A,invoicePaid:!1}:A);x(_)},ie=p=>{const B=p.getFullYear(),_=p.getMonth(),A=new Date(B,_,1),W=new Date(B,_+1,0),E=[];for(let le=0;le<A.getDay();le++)E.push(null);for(let le=1;le<=W.getDate();le++)E.push(new Date(B,_,le));return E},ce=p=>{const B=p.toISOString().split("T")[0];j.includes(B)?Q(j.filter(_=>_!==B)):Q([...j,B])},ae=()=>{$(new Date(T.getFullYear(),T.getMonth()-1,1))},N=()=>{$(new Date(T.getFullYear(),T.getMonth()+1,1))},R=p=>new Date(p+"T12:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-2",style:{color:"#3d59ab"},children:[e.jsx(_e,{className:"inline mr-2",size:28}),"Client Billing & Dates"]}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Set delivery dates, bill due dates, and invoice links for each client"}),e.jsx("div",{className:"space-y-4",children:te.map((p,B)=>{const A=[...p.deliveryDates||["","","",""]];for(;A.length<4;)A.push("");return e.jsxs("div",{className:"p-4 rounded-lg border-2",style:{borderColor:"#ebb582",backgroundColor:"#f9f9ed"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-bold text-lg",style:{color:"#3d59ab"},children:p.displayName||p.name}),e.jsxs("span",{className:"text-sm text-gray-500",children:[p.mealsPerWeek," meals/week • ",p.portions||1," portions"]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Next 4 Delivery Dates"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:A.slice(0,4).map((W,E)=>e.jsx("input",{type:"date",value:W||"",onChange:le=>h(p.name,E,le.target.value),className:"px-3 py-2 border-2 rounded-lg text-sm",style:{borderColor:"#ebb582"}},E))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bill Due Date"}),e.jsx("input",{type:"date",value:p.billDueDate||"",onChange:W=>K(p.name,"billDueDate",W.target.value),className:"w-full px-3 py-2 border-2 rounded-lg text-sm",style:{borderColor:"#ebb582"}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Invoice Link (Honeybook)"}),e.jsx("input",{type:"url",value:p.honeyBookLink||"",onChange:W=>K(p.name,"honeyBookLink",W.target.value),placeholder:"Paste invoice link...",className:"w-full px-3 py-2 border-2 rounded-lg text-sm",style:{borderColor:"#ebb582"}})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded-lg hover:bg-white",children:[e.jsx("input",{type:"checkbox",checked:p.invoicePaid||!1,onChange:W=>O(p.name,W.target.checked),className:"w-5 h-5 rounded border-2",style:{accentColor:"#22c55e"}}),e.jsx("span",{className:"text-sm font-medium",children:p.invoicePaid?e.jsxs("span",{className:"text-green-600 flex items-center gap-1",children:[e.jsx(pe,{size:16})," Invoice Paid"]}):e.jsx("span",{className:"text-gray-600",children:"Mark as Paid"})})]})})]}),p.billDueDate&&new Date(p.billDueDate+"T12:00:00")<X&&!p.invoicePaid&&e.jsxs("div",{className:"mt-2 p-2 rounded bg-red-100 text-red-700 text-sm flex items-center gap-2",children:[e.jsx(Ve,{size:16}),"Invoice overdue!"]})]},B)})})]}),q.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("h2",{className:"text-xl font-bold mb-2",style:{color:"#3d59ab"},children:["Paused Clients (",q.length,")"]}),e.jsx("div",{className:"space-y-2",children:q.map((p,B)=>e.jsxs("div",{className:"p-3 rounded-lg flex items-center justify-between bg-gray-50 border border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:p.displayName||p.name}),p.pausedDate&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Paused: ",new Date(p.pausedDate+"T12:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]}),p.billingNotes&&e.jsx("p",{className:"text-sm text-gray-500",children:p.billingNotes})]}),e.jsx("span",{className:"text-xs px-2 py-1 rounded bg-gray-200 text-gray-600",children:"Paused"})]},B))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>H(!P),className:"w-full p-4 flex items-center justify-between hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{size:24,style:{color:"#3d59ab"}}),e.jsx("span",{className:"text-lg font-bold",style:{color:"#3d59ab"},children:"Availability Calendar"}),j.length>0&&e.jsxs("span",{className:"text-sm px-2 py-1 rounded bg-red-100 text-red-700",children:[j.length," blocked"]})]}),P?e.jsx(os,{size:24}):e.jsx(cs,{size:24})]}),P&&e.jsxs("div",{className:"p-6 border-t",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Click dates to block them from client selection"}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:ae,className:"p-2 rounded hover:bg-gray-100",children:e.jsx(Rs,{size:20})}),e.jsx("span",{className:"font-bold",children:T.toLocaleDateString("en-US",{month:"long",year:"numeric"})}),e.jsx("button",{onClick:N,className:"p-2 rounded hover:bg-gray-100",children:e.jsx(Ws,{size:20})})]}),e.jsxs("div",{className:"grid grid-cols-7 gap-1 mb-4",children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(p=>e.jsx("div",{className:"text-center text-sm font-medium text-gray-500 py-2",children:p},p)),ie(T).map((p,B)=>{if(!p)return e.jsx("div",{},`empty-${B}`);const _=p.toISOString().split("T")[0],A=j.includes(_),W=p<new Date(X.toISOString().split("T")[0]),E=_===X.toISOString().split("T")[0];return e.jsx("button",{onClick:()=>!W&&ce(p),disabled:W,className:`p-2 rounded-lg text-center transition-colors ${W?"text-gray-300 cursor-not-allowed":A?"bg-red-500 text-white hover:bg-red-600":E?"bg-blue-100 hover:bg-blue-200":"hover:bg-gray-100"}`,children:p.getDate()},_)})]}),j.length>0&&e.jsxs("div",{className:"p-3 rounded-lg bg-red-50 border border-red-200",children:[e.jsxs("p",{className:"text-sm font-medium text-red-700 mb-2",children:[j.length," date",j.length>1?"s":""," blocked:"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:j.sort().map(p=>e.jsxs("span",{className:"text-xs px-2 py-1 rounded bg-red-100 text-red-700 flex items-center gap-1",children:[R(p),e.jsx("button",{onClick:()=>Q(j.filter(B=>B!==p)),children:e.jsx(fe,{size:12})})]},p))})]})]})]})]})}function ja({client:n,date:x,menuItems:j}){const Q=new Date(x+"T12:00:00").toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}).toUpperCase(),T=[];j.forEach(P=>{const H={protein:P.protein,sides:[P.veg,P.starch].filter(Boolean)};(H.protein||H.sides.length>0)&&T.push(H),P.extras&&P.extras.forEach(X=>{T.push({protein:X,sides:[],isExtra:!0})})});const $=n.displayName||n.name;return e.jsxs("div",{className:"overflow-hidden shadow-lg",style:{backgroundColor:"#fff"},children:[e.jsxs("div",{className:"relative px-4 pt-6 pb-8",style:{backgroundColor:"#f9f9ed",backgroundImage:"url(/pattern4.png)",backgroundSize:"cover",backgroundPosition:"center"},children:[e.jsx("p",{className:"text-center mb-2",style:{fontFamily:'"Glacial Indifference", sans-serif',fontSize:"12px",letterSpacing:"0.3em",color:"#5a5a5a"},children:"GOLDFINCH CHEF SERVICES"}),e.jsxs("h2",{className:"text-center mb-3",style:{color:"#3d59ab",fontFamily:'"Poller One", cursive',fontSize:"18px",textTransform:"uppercase",letterSpacing:"0.05em",textDecoration:"underline",textDecorationColor:"#3d59ab",textUnderlineOffset:"4px"},children:[$,"'s Menu"]}),e.jsx("p",{className:"text-center mb-4",style:{color:"#5a5a5a",fontFamily:'"Beth Ellen", cursive',fontSize:"12px"},children:"here's what to expect on your plate!"}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("img",{src:"/goldfinch5.png",alt:"Goldfinch",className:"w-12 h-12 object-contain"}),e.jsx("p",{style:{fontFamily:'"Glacial Indifference", sans-serif',fontSize:"14px",letterSpacing:"0.2em",color:"#5a5a5a"},children:Q})]})]}),e.jsx("div",{className:"px-6 py-8",style:{backgroundColor:"#d9a87a"},children:e.jsx("div",{className:"space-y-8",children:T.map((P,H)=>e.jsxs("div",{className:"text-center",children:[P.protein&&e.jsx("h3",{style:{color:"#ffffff",fontFamily:'"Glacial Indifference", sans-serif',fontSize:"1.1rem",fontWeight:"bold",letterSpacing:"0.15em",textTransform:"uppercase",marginBottom:P.sides.length>0?"0.5rem":0},children:P.protein}),P.sides.length>0&&e.jsx("p",{style:{color:"#f5e6d3",fontFamily:'"Glacial Indifference", sans-serif',fontSize:"0.85rem",letterSpacing:"0.1em",textTransform:"uppercase"},children:P.sides.join(", ")})]},H))})}),e.jsxs("div",{className:"relative px-6 py-6",style:{backgroundColor:"#f9f9ed",fontFamily:'"Glacial Indifference", sans-serif'},children:[e.jsx("h4",{className:"mb-3",style:{color:"#3d59ab",fontFamily:'"Poller One", cursive',fontSize:"1.1rem",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Get Ready!"}),e.jsx("p",{className:"mb-4 pr-20",style:{color:"#5a5a5a",fontSize:"0.9rem",lineHeight:"1.5"},children:"Remember to put out bags, containers, and ice packs. And get excited – great food is on the way!"}),e.jsx("img",{src:"/stemflower.png",alt:"",className:"absolute right-4 bottom-4 h-20 object-contain"})]})]})}function va({clients:n,menuItems:x,updateMenuItems:j,lockWeekWithSnapshot:Q,weeklyTasks:T={},clientPortalData:$={},recipes:P={}}){const H=qt(),X=new Date().toISOString().split("T")[0],[te,q]=w.useState({}),h=(()=>{const t=new Date,r=t.getDay(),o=t.getDate()-r+(r===0?-6:1);return t.setDate(o),t.toISOString().split("T")[0]})(),O=T[h]||{},ie=t=>{const r=O[t]||{};return r.menusPlanned&&r.menusSent},ce=t=>{const r=O[t]||{};return{menusPlanned:!!r.menusPlanned,menusSent:!!r.menusSent,complete:r.menusPlanned&&r.menusSent}},ae=t=>{const r=n.find(c=>c.name===t);if(!r)return{status:"unknown",daysOverdue:0,hasDates:!1,canApprove:!1,warning:null,blocked:!0};const o=r.deliveryDates&&r.deliveryDates.length>0;if(r.status==="paused")return{status:"paused",daysOverdue:0,hasDates:o,canApprove:!1,warning:null,blocked:!0,message:"Subscription paused — cannot send menu"};let u=0;if(r.billDueDate){const c=new Date(r.billDueDate+"T12:00:00"),L=new Date-c;u=Math.floor(L/(1e3*60*60*24))}return u>=8?{status:"paused",daysOverdue:u,hasDates:o,canApprove:!1,warning:null,blocked:!0,message:"Subscription paused — cannot send menu"}:u>=1?{status:"grace",daysOverdue:u,hasDates:o,canApprove:!0,warning:`Invoice overdue (${u} day${u>1?"s":""})`,blocked:!1}:o?{status:"active",daysOverdue:0,hasDates:!0,canApprove:!0,warning:null,blocked:!1}:{status:"active",daysOverdue:0,hasDates:!1,canApprove:!0,warning:"Delivery dates not set",blocked:!1}},N=()=>n.filter(t=>{var o;if(t.status!=="active"||t.chefChoice!==!1)return!1;const r=$[t.name];return(o=r==null?void 0:r.ingredientPicks)==null?void 0:o.submittedAt}).map(t=>{var o;const r=((o=$[t.name])==null?void 0:o.ingredientPicks)||{};return{client:t,picks:r,mealsPerWeek:r.mealsPerWeek||t.mealsPerWeek||3}}),R=(t,r)=>{if(te[t])return;const o=Array(r).fill(null).map(()=>({protein:"",veg:"",starch:""}));q(u=>({...u,[t]:o}))},p=(t,r,o,u)=>{q(c=>{const G=[...c[t]||[]];return G[r]={...G[r],[o]:u},{...c,[t]:G}})},B=t=>{const r=te[t];return r?r.every(o=>o.protein&&o.veg&&o.starch):!1},_=(t,r,o,u)=>{const c=te[t]||[],L=r[{protein:"proteins",veg:"veggies",veggie:"veggies",starch:"starches"}[o]]||[],v=c.filter((i,k)=>k!==u).map(i=>i[o==="veggie"?"veg":o]).filter(Boolean);return L.filter(i=>!v.includes(i))},A=(t,r,o)=>{const u=t.portions||t.persons||1;return r.map((c,G)=>({id:`${t.name}-${o}-${G}-${Date.now()}`,clientName:t.name,date:o,portions:u,protein:c.protein,veg:c.veg,starch:c.starch,extras:[],approved:!1,fromClientPicks:!0}))},W=t=>{var L;const r=te[t.name];if(!r||!B(t.name)){alert("Please pair all meals before approving.");return}const o=((L=$[t.name])==null?void 0:L.selectedDates)||[],c=(o.length>0?o:t.deliveryDates||[]).find(v=>v>=X);if(!c){alert("No upcoming delivery date found for this client.");return}const G=A(t,r,c);j([...x,...G]),q(v=>{const i={...v};return delete i[t.name],i}),alert(`Menu created for ${t.displayName||t.name}! It will appear in the approval queue below.`)},E=N(),le=()=>{const t=x.filter(o=>!o.approved&&o.date>=X),r={};return t.forEach(o=>{r[o.date]||(r[o.date]={}),r[o.date][o.clientName]||(r[o.date][o.clientName]=[]),r[o.date][o.clientName].push(o)}),Object.entries(r).sort(([o],[u])=>o.localeCompare(u)).map(([o,u])=>({date:o,weekId:qe(o),menus:Object.entries(u).sort(([c],[G])=>c.localeCompare(G)).map(([c,G])=>({clientName:c,items:G}))}))},xe=(t,r)=>{const o=qe(r),u=x.map(c=>c.clientName===t&&c.date===r&&!c.approved?{...c,approved:!0}:c);j(u),Q(o)},m=()=>{const t=[],r=[],o=[],u=[];if(I.forEach(({menus:v})=>{v.forEach(({clientName:i})=>{const k=ae(i),f=ie(i);k.blocked?o.push(i):f?(t.push(i),k.warning&&u.push({clientName:i,warning:k.warning})):r.push(i)})}),t.length===0){let v="No menus ready to approve.";o.length>0&&(v+=`

${o.length} client(s) have paused subscriptions.`),r.length>0&&(v+=`

${r.length} client(s) have incomplete tasks.`),alert(v);return}let c=`Approve ${t.length} menu(s) and push to client portals?

This will lock the week and menus will appear in KDS for cooking.`;if(u.length>0&&(c+=`

⚠️ Warnings for ${u.length} client(s):`,u.slice(0,3).forEach(({clientName:v,warning:i})=>{c+=`
• ${v}: ${i}`}),u.length>3&&(c+=`
• ...and ${u.length-3} more`)),(r.length>0||o.length>0)&&(c+=`

Will NOT be approved:`,r.length>0&&(c+=`
• ${r.length} with incomplete tasks`),o.length>0&&(c+=`
• ${o.length} with paused subscriptions`)),!window.confirm(c))return;const G=new Set,L=x.map(v=>{if(!v.approved&&v.date>=X){const i=ae(v.clientName);if(ie(v.clientName)&&i.canApprove)return G.add(qe(v.date)),{...v,approved:!0}}return v});j(L),G.forEach(v=>{Q(v)}),alert(`${t.length} menu(s) approved and pushed to client portals!`)},D=(t,r)=>{if(!window.confirm(`Send ${t}'s menu back for editing?

This will remove it from the approval queue. You can recreate it in Menu Planner.`))return;const o=x.filter(u=>!(u.clientName===t&&u.date===r&&!u.approved));j(o),H("/?tab=menu")},I=le(),y=I.reduce((t,r)=>t+r.menus.length,0),J=I.reduce((t,r)=>t+r.menus.filter(o=>{const u=ae(o.clientName);return ie(o.clientName)&&u.canApprove}).length,0);return I.reduce((t,r)=>t+r.menus.filter(o=>ae(o.clientName).blocked).length,0),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",style:{color:"#3d59ab"},children:"Menu Approval"}),e.jsx("p",{className:"text-gray-600",children:"Review all menus before pushing to client portals. Approving will lock the week and send menus to KDS."})]}),y>0&&e.jsxs("button",{onClick:m,disabled:J===0,className:`flex items-center gap-2 px-6 py-3 rounded-lg text-white font-medium transition-opacity ${J>0?"hover:opacity-90":"opacity-50 cursor-not-allowed"}`,style:{backgroundColor:"#10b981"},title:J===0?"Complete weekly tasks to enable approval":"",children:[e.jsx(pe,{size:20}),"Approve & Push Ready (",J,"/",y,")"]})]}),I.length===0&&E.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(pe,{size:48,className:"mx-auto mb-4 text-green-500"}),e.jsx("p",{className:"text-gray-600",children:"All menus have been approved!"}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Create new menus in the Menu tab, then come back here to approve them."}),e.jsxs(ts,{to:"/?tab=menu",className:"inline-flex items-center gap-2 mt-4 px-4 py-2 rounded-lg border-2 hover:bg-gray-50",style:{borderColor:"#ebb582"},children:[e.jsx(Ls,{size:18}),"Go to Menu Planner"]})]}):e.jsxs("p",{className:"text-sm text-gray-500",children:[y>0&&`${y} menu${y>1?"s":""} pending approval`,y>0&&E.length>0&&" • ",E.length>0&&`${E.length} client${E.length>1?"s":""} with ingredient picks to pair`]})]}),E.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",style:{color:"#3d59ab"},children:[e.jsx(Ht,{size:24}),"Client Ingredient Picks"]}),e.jsx("p",{className:"text-gray-600 mb-6",children:"These clients picked their ingredients. Pair them into meals, then create their menu."}),e.jsx("div",{className:"space-y-6",children:E.map(({client:t,picks:r,mealsPerWeek:o})=>{var G,L,v;te[t.name]||R(t.name,o);const u=te[t.name]||[],c=B(t.name);return e.jsxs("div",{className:"border-2 rounded-lg overflow-hidden",style:{borderColor:"#ebb582"},children:[e.jsxs("div",{className:"p-4",style:{backgroundColor:"#f9f9ed"},children:[e.jsx("h4",{className:"font-bold text-lg",style:{color:"#3d59ab"},children:t.displayName||t.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[o," meals • ",t.portions||t.persons||1," portions"]}),r.notes&&e.jsxs("p",{className:"text-sm text-amber-700 mt-2 bg-amber-50 p-2 rounded",children:["Note: ",r.notes]})]}),e.jsxs("div",{className:"p-4 border-t grid grid-cols-3 gap-4 text-sm",style:{borderColor:"#ebb582"},children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-600 mb-1",children:"Proteins"}),(G=r.proteins)==null?void 0:G.map((i,k)=>e.jsx("p",{className:"text-gray-700",children:i},k))]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-600 mb-1",children:"Veggies"}),(L=r.veggies)==null?void 0:L.map((i,k)=>e.jsx("p",{className:"text-gray-700",children:i},k))]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-amber-600 mb-1",children:"Starches"}),(v=r.starches)==null?void 0:v.map((i,k)=>e.jsx("p",{className:"text-gray-700",children:i},k))]})]}),e.jsxs("div",{className:"p-4 border-t",style:{borderColor:"#ebb582"},children:[e.jsx("p",{className:"font-medium mb-3",style:{color:"#3d59ab"},children:"Pair into Meals:"}),e.jsx("div",{className:"space-y-3",children:u.map((i,k)=>e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-500 w-16",children:["Meal ",k+1,":"]}),e.jsxs("select",{value:i.protein,onChange:f=>p(t.name,k,"protein",f.target.value),className:"flex-1 min-w-[120px] p-2 border rounded text-sm",style:{borderColor:i.protein?"#22c55e":"#ebb582"},children:[e.jsx("option",{value:"",children:"Protein"}),_(t.name,r,"protein",k).map(f=>e.jsx("option",{value:f,children:f},f))]}),e.jsxs("select",{value:i.veg,onChange:f=>p(t.name,k,"veg",f.target.value),className:"flex-1 min-w-[120px] p-2 border rounded text-sm",style:{borderColor:i.veg?"#22c55e":"#ebb582"},children:[e.jsx("option",{value:"",children:"Veggie"}),_(t.name,r,"veggie",k).map(f=>e.jsx("option",{value:f,children:f},f))]}),e.jsxs("select",{value:i.starch,onChange:f=>p(t.name,k,"starch",f.target.value),className:"flex-1 min-w-[120px] p-2 border rounded text-sm",style:{borderColor:i.starch?"#22c55e":"#ebb582"},children:[e.jsx("option",{value:"",children:"Starch"}),_(t.name,r,"starch",k).map(f=>e.jsx("option",{value:f,children:f},f))]})]},k))})]}),e.jsx("div",{className:"p-4 border-t flex justify-end",style:{borderColor:"#ebb582"},children:e.jsxs("button",{onClick:()=>W(t),disabled:!c,className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${c?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:[e.jsx(Ne,{size:16}),"Create Menu"]})})]},t.name)})})]}),I.map(({date:t,weekId:r,menus:o})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-lg font-bold",style:{color:"#3d59ab"},children:new Date(t+"T12:00:00").toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})}),e.jsxs("span",{className:"text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-600",children:["Week ",r]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map(({clientName:u,items:c})=>{const G=n.find(f=>f.name===u)||{name:u},L=ce(u),v=ae(u),i=L.complete&&v.canApprove,k=v.blocked;return e.jsxs("div",{className:`bg-white rounded-lg shadow-lg overflow-hidden ${k?"opacity-60":""}`,children:[e.jsx(ja,{client:G,date:t,menuItems:c}),(v.warning||v.blocked)&&e.jsx("div",{className:"px-3 py-2 border-t",style:{borderColor:"#ebb582",backgroundColor:k?"#fef2f2":v.status==="grace"?"#fef3c7":"#fffbeb"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ve,{size:14,className:k?"text-red-600":"text-amber-600"}),e.jsx("span",{className:`text-xs font-medium ${k?"text-red-700":"text-amber-700"}`,children:v.message||v.warning})]})}),e.jsxs("div",{className:"px-3 py-2 border-t",style:{borderColor:"#ebb582",backgroundColor:L.complete?"#f0fdf4":"#fef3c7"},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium",style:{color:L.complete?"#15803d":"#92400e"},children:"Weekly Tasks"}),!L.complete&&e.jsxs(ts,{to:"/admin?section=subscriptions",className:"text-xs text-blue-600 hover:underline flex items-center gap-1",children:["Complete Tasks",e.jsx(ns,{size:10})]})]}),e.jsxs("div",{className:"flex gap-3 mt-1",children:[e.jsxs("span",{className:`text-xs flex items-center gap-1 ${L.menusPlanned?"text-green-600":"text-gray-400"}`,children:[L.menusPlanned?e.jsx(pe,{size:12}):e.jsx(fe,{size:12}),"Menu Planned"]}),e.jsxs("span",{className:`text-xs flex items-center gap-1 ${L.menusSent?"text-green-600":"text-gray-400"}`,children:[L.menusSent?e.jsx(pe,{size:12}):e.jsx(fe,{size:12}),"Menu Sent"]})]})]}),e.jsxs("div",{className:"p-3 border-t flex justify-between gap-2",style:{borderColor:"#ebb582"},children:[e.jsxs("button",{onClick:()=>D(u,t),className:"flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium border-2 hover:bg-red-50 transition-colors",style:{borderColor:"#dc2626",color:"#dc2626"},children:[e.jsx(na,{size:16}),"Edit"]}),k?e.jsxs("span",{className:"flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-500",children:[e.jsx(fe,{size:16}),"Blocked"]}):e.jsxs("button",{onClick:()=>i&&xe(u,t),disabled:!i,className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${i?"bg-green-500 text-white hover:bg-green-600":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,title:k?"Subscription paused":L.complete?"Approve and push to client portal":"Complete weekly tasks first",children:[e.jsx(pe,{size:16}),"Approve"]})]})]},`${u}-${t}`)})})]},t)),y>0&&J>0&&e.jsx("div",{className:"sticky bottom-4 flex justify-center",children:e.jsxs("button",{onClick:m,className:"flex items-center gap-2 px-8 py-4 rounded-lg text-white font-medium shadow-lg hover:opacity-90 transition-opacity",style:{backgroundColor:"#10b981"},children:[e.jsx(pe,{size:24}),"Approve & Push Ready Menus (",J,"/",y,")"]})})]})}function Fa(){const{clients:n,drivers:x,menuItems:j,deliveryLog:Q,readyForDelivery:T,clientPortalData:$,blockedDates:P,adminSettings:H,customTasks:X,weeklyTasks:te,recipes:q,masterIngredients:K,groceryBills:h,isLoaded:O,updateDrivers:ie,updateBlockedDates:ce,updateAdminSettings:ae,updateCustomTasks:N,updateMenuItems:R,updateWeeklyTasks:p,updateRecipes:B,updateMasterIngredients:_,updateClients:A,updateGroceryBills:W,weeks:E,updateWeeks:le,lockWeekWithSnapshot:xe}=ga(),[m]=Ut(),[D,I]=w.useState("overview"),[y,J]=w.useState(Ss);w.useEffect(()=>{const s=m.get("section");s==="menu-approval"||s==="approvals"||s==="dashboard"||s==="tasks"?I("overview"):s&&I(s)},[m]);const[t,r]=w.useState(null),[o,u]=w.useState(null),[c,G]=w.useState(new Date),[L,v]=w.useState({title:"",notes:"",dueDate:""}),[i,k]=w.useState(new Date().toISOString().split("T")[0]),[f,b]=w.useState([]),[se,V]=w.useState(Ps),[z,d]=w.useState(()=>qe(new Date().toISOString().split("T")[0])),S=s=>{if(!E[s])return;const a={...E[s],status:"unlocked"};le({...E,[s]:a})},[U,ue]=w.useState(Fs),[de,Y]=w.useState(null),we=ss.useRef(),[Ce,he]=w.useState(Ts),[Le,Ze]=w.useState(null),[is,Be]=w.useState(null),[ds,Ke]=w.useState([]),Hs=ss.useRef(),ms=ss.useRef(),[xs,_s]=w.useState(null),[Je,ps]=w.useState({name:"",displayName:"",persons:1,contacts:[{name:"",email:"",phone:"",address:""}],notes:"",mealsPerWeek:0,frequency:"weekly",status:"active",pausedDate:"",honeyBookLink:"",billingNotes:"",deliveryDay:"",zone:"",pickup:!1,planPrice:0,serviceFee:0,prepayDiscount:!1,newClientFeePaid:!1,paysOwnGroceries:!1}),[je,ze]=w.useState({date:new Date().toISOString().split("T")[0],amount:"",store:"",notes:""}),me=new Date,{start:Ee,end:Me}=ba(me),us=()=>T.filter(s=>{const a=new Date(s.date+"T12:00:00");return a>=Ee&&a<=Me}),Vs=()=>Q.filter(s=>{const a=new Date(s.date+"T12:00:00");return a>=Ee&&a<=Me}),Ys=()=>Q.filter(s=>{const a=new Date(s.date+"T12:00:00");return a>=Ee&&a<=Me&&s.problem}),hs=()=>{const s=new Date,a=new Date(s);return a.setDate(a.getDate()+7),n.filter(l=>l.status!=="active"||!l.billDueDate?!1:new Date(l.billDueDate+"T12:00:00")<=a).sort((l,g)=>new Date(l.billDueDate)-new Date(g.billDueDate))},Zs=()=>Object.entries($).filter(([s,a])=>a.substitutionRequest).map(([s,a])=>({clientName:s,...a.substitutionRequest})),Ks=()=>(me.toISOString().split("T")[0],n.filter(s=>{if(s.status!=="active"||!s.deliveryDay)return!1;const a={Monday:1,Tuesday:2,Thursday:4}[s.deliveryDay];if(!a)return!1;for(let l=new Date(Ee);l<=Me;l.setDate(l.getDate()+1))if(l.getDay()===a&&l>=me){const g=l.toISOString().split("T")[0];if(!T.some(C=>C.clientName===s.name&&C.date===g))return!0}return!1})),Js=()=>{const s=me.toISOString().split("T")[0],a=j.filter(g=>!g.approved&&g.date>=s);return new Set(a.map(g=>`${g.clientName}-${g.date}`)).size},Xs=()=>Q.filter(s=>{const a=new Date(s.date+"T12:00:00"),l=(me-a)/(1e3*60*60*24);return l>=3&&l<=10&&!s.bagsReturned}),Qs=()=>{const s=[],a=hs(),l=Ks(),g=Zs(),F=Xs(),C=us();a.length>0&&s.push({id:"renewals",category:"Billing & Renewals",title:`${a.length} client${a.length>1?"s":""} due for renewal`,details:a.map(ee=>ee.displayName||ee.name),icon:Es,color:"#f59e0b"}),l.length>0&&s.push({id:"menus",category:"Menu Planning",title:`Plan menus for ${l.length} client${l.length>1?"s":""}`,details:l.map(ee=>ee.displayName||ee.name),icon:_t,color:"#3d59ab"}),g.length>0&&s.push({id:"substitutions",category:"Substitution Requests",title:`${g.length} substitution request${g.length>1?"s":""} to review`,details:g.map(ee=>`${ee.clientName}: ${ee.originalDish} → ${ee.requestedSubstitution}`),icon:rs,color:"#8b5cf6"}),C.length>0&&s.push({id:"delivery-prep",category:"Delivery Prep",title:`${C.length} order${C.length>1?"s":""} ready for delivery`,details:C.map(ee=>`${ee.clientName} - ${Ae(ee.date)}`),icon:$s,color:"#10b981"}),F.length>0&&s.push({id:"bags",category:"Bags Follow-up",title:`Follow up on ${F.length} bag return${F.length>1?"s":""}`,details:F.map(ee=>ee.clientName),icon:Vt,color:"#ec4899"});const Z=n.filter(ee=>ee.paysOwnGroceries&&ee.status==="active").filter(ee=>C.some(ve=>ve.clientName===ee.name));Z.length>0&&s.push({id:"own-groceries",category:"Grocery Costs",title:`Add grocery costs for ${Z.length} client${Z.length>1?"s":""}`,details:Z.map(ee=>ee.displayName||ee.name),icon:Ye,color:"#059669",action:"groceries"});const Pe=n.filter(ee=>ee.chefChoice===!1&&ee.status==="active").filter(ee=>{const ve=$[ee.name],es=(ve==null?void 0:ve.ingredientPicks)||(ve==null?void 0:ve.dateIngredientPicks)&&Object.keys(ve.dateIngredientPicks).length>0,Bt=j.some(Gt=>Gt.clientName===(ee.displayName||ee.name));return es&&!Bt});return Pe.length>0&&s.push({id:"client-dish-picks",category:"Client Dish Picks",title:`${Pe.length} client${Pe.length>1?"s":""} submitted dish picks`,details:Pe.map(ee=>ee.displayName||ee.name),icon:$e,color:"#8b5cf6"}),s},et=()=>{if(!y.name){alert("Please enter a driver name");return}ie([...x,{...y,id:Date.now()}]),J(Ss)},st=s=>{window.confirm("Delete this driver?")&&ie(x.filter((a,l)=>l!==s))},tt=s=>{r(s),u({...x[s]})},at=()=>{const s=[...x];s[t]=o,ie(s),r(null),u(null)},gs=s=>!s||s.length<2?[]:K.filter(a=>{const l=zs(s,a.name);return l>.7&&l<1}),Te=s=>K.find(a=>Ge(a.name)===Ge(s)),lt=()=>{const s=new Set;return K.forEach(a=>{a.source&&a.source.trim()&&s.add(a.source.trim())}),Array.from(s).sort()},nt=(s,a)=>{const l=Te(s);return l&&a?(_(K.map(g=>g.id===l.id?{...g,cost:a}:g)),!0):!1},rt=()=>{let s=0,a=0;const l={...q};return Object.keys(l).forEach(g=>{l[g]=l[g].map(F=>{const C=F.ingredients.map(M=>{const Z=Te(M.name);if(Z){const Se={...M};return Z.cost&&Z.cost!==M.cost&&(Se.cost=Z.cost,a++),Z.source&&Z.source!==M.source&&(Se.source=Z.source),Z.section&&Z.section!=="Other"&&Z.section!==M.section&&(Se.section=Z.section),Z.unit&&Z.unit!==M.unit&&(Se.unit=Z.unit),Se}else if(M.name)return s++,M;return M});return{...F,ingredients:C}})}),Object.values(l).forEach(g=>{g.forEach(F=>{F.ingredients.forEach(C=>{C.name&&!Te(C.name)&&Xe(C)})})}),B(l),{ingredientsAdded:s,costsUpdated:a}},Xe=s=>{if(!s.name)return;const a=Te(s.name);if(a){(s.cost||s.source||s.section!=="Other")&&_(K.map(l=>l.id===a.id?{...l,cost:s.cost||l.cost,source:s.source||l.source,section:s.section!=="Other"?s.section:l.section}:l));return}_([...K,{id:Date.now()+Math.random(),name:s.name,cost:s.cost||"",unit:s.unit||"oz",source:s.source||"",section:s.section||"Other"}])},bs=s=>s!=null&&s.ingredients?s.ingredients.reduce((a,l)=>{const g=Te(l.name),F=parseFloat((g==null?void 0:g.cost)||l.cost||0),C=parseFloat(l.quantity||0);return a+F*C},0):0,ot=()=>{const s={};let a=0;return Object.entries(q).forEach(([l,g])=>{s[l]=g.length,a+=g.length}),s.total=a,s},ct=()=>{if(!se.protein&&!se.veg&&!se.starch&&se.extras.length===0){alert("Please select at least one dish");return}if(f.length===0){alert("Please select at least one client");return}const s=f.map(a=>{const l=n.find(F=>F.name===a),g=l&&(l.portions||l.persons)||1;return{...se,clientName:a,date:i,portions:g,id:Date.now()+Math.random(),approved:!1}});R([...j,...s]),V(Ps)},it=s=>R(j.filter(a=>a.id!==s)),dt=()=>{window.confirm("Clear all menu items?")&&(R([]),b([]))},mt=()=>{const s={};return j.forEach(a=>{s[a.clientName]||(s[a.clientName]=[]),s[a.clientName].push(a)}),s},xt=()=>{if(!U.name){alert("Please enter a recipe name");return}const s=U.ingredients.filter(a=>a.name&&a.quantity);if(s.length===0){alert("Please add at least one ingredient with name and quantity");return}s.forEach(a=>Xe(a)),B({...q,[U.category]:[...q[U.category],{name:U.name,instructions:U.instructions,ingredients:s}]}),ue(Fs),alert("Recipe saved!")},pt=(s,a)=>{window.confirm("Delete this recipe?")&&B({...q,[s]:q[s].filter((l,g)=>g!==a)})},ut=(s,a)=>{const l=q[s][a];Y({category:s,index:a,recipe:{...l,ingredients:l.ingredients.map(g=>({name:g.name||"",quantity:g.quantity||"",unit:g.unit||"oz",cost:g.cost||"",source:g.source||"",section:g.section||"Other"}))}})},ht=(s,a,l)=>{const g=[...de.recipe.ingredients];g[s][a]=l,Y({...de,recipe:{...de.recipe,ingredients:g}})},gt=()=>{Y({...de,recipe:{...de.recipe,ingredients:[...de.recipe.ingredients,{name:"",quantity:"",unit:"oz",cost:"",source:"",section:"Other"}]}})},bt=s=>{Y({...de,recipe:{...de.recipe,ingredients:de.recipe.ingredients.filter((a,l)=>l!==s)}})},yt=()=>{const{category:s,index:a,recipe:l}=de,g=l.ingredients.filter(C=>C.name&&C.quantity);g.forEach(C=>Xe(C));const F={...q};F[s][a]={...l,ingredients:g},B(F),Y(null),alert("Recipe updated!")},ft=()=>{if(!Ce.name){alert("Please enter an ingredient name");return}const s=gs(Ce.name),a=Te(Ce.name);if(a){alert(`"${Ce.name}" already exists as "${a.name}"`);return}s.length>0&&!window.confirm(`Similar ingredients found: ${s.map(l=>l.name).join(", ")}

Add "${Ce.name}" anyway?`)||(_([...K,{...Ce,id:Date.now()}]),he(Ts),alert("Ingredient added!"))},jt=s=>{window.confirm("Delete this ingredient?")&&_(K.filter(a=>a.id!==s))},vt=s=>{Ze(s.id),Be({...s})},Nt=()=>{_(K.map(s=>s.id===Le?{...is}:s)),Ze(null),Be(null)},kt=()=>{Ze(null),Be(null)},Ct=()=>{const s=[],a=new Set;K.forEach((l,g)=>{K.forEach((F,C)=>{if(g>=C)return;const M=[l.id,F.id].sort().join("-");if(a.has(M))return;a.add(M);const Z=zs(l.name,F.name);Z>.7&&Z<1&&s.push({ing1:l,ing2:F,similarity:Z})})}),Ke(s),s.length===0&&alert("No duplicate ingredients found!")},wt=(s,a)=>{const l=K.find(C=>C.id===s),g=K.find(C=>C.id===a);if(!l||!g)return;const F={...q};Object.keys(F).forEach(C=>{F[C]=F[C].map(M=>({...M,ingredients:M.ingredients.map(Z=>Ge(Z.name)===Ge(g.name)?{...Z,name:l.name}:Z)}))}),B(F),_(K.filter(C=>C.id!==a)),Ke(ds.filter(C=>C.ing1.id!==a&&C.ing2.id!==a)),alert(`Merged "${g.name}" into "${l.name}"`)},Dt=s=>{const a=s.getFullYear(),l=s.getMonth(),g=new Date(a,l,1),F=new Date(a,l+1,0),C=[];for(let M=0;M<g.getDay();M++)C.push(null);for(let M=1;M<=F.getDate();M++)C.push(new Date(a,l,M));return C},St=s=>{const a=s.toISOString().split("T")[0];P.includes(a)?ce(P.filter(l=>l!==a)):ce([...P,a])},Pt=()=>{G(new Date(c.getFullYear(),c.getMonth()-1,1))},Ft=()=>{G(new Date(c.getFullYear(),c.getMonth()+1,1))},ys=()=>{if(!L.title){alert("Please enter a task title");return}N([...X,{...L,id:Date.now(),completed:!1}]),v({title:"",notes:"",dueDate:""})},fs=s=>{N(X.map(a=>a.id===s?{...a,completed:!a.completed}:a))},js=s=>{N(X.filter(a=>a.id!==s))},Tt=()=>{if(!Je.name){alert("Please enter a client name");return}A([...n,{...Je,id:Date.now()}]),ps({name:"",displayName:"",persons:1,contacts:[{name:"",email:"",phone:"",address:""}],notes:"",mealsPerWeek:0,frequency:"weekly",status:"active",pausedDate:"",honeyBookLink:"",billingNotes:"",deliveryDay:"",zone:"",pickup:!1,planPrice:0,serviceFee:0,prepayDiscount:!1,newClientFeePaid:!1,paysOwnGroceries:!1})},$t=s=>{window.confirm("Delete this client?")&&A(n.filter((a,l)=>l!==s))},zt=()=>{const s=["name","displayName","persons","address","email","phone","mealsPerWeek","frequency","status","zone","deliveryDay","pickup","planPrice","serviceFee","prepayDiscount","newClientFeePaid","paysOwnGroceries","billingNotes"],a=[s.join(","),...n.map(C=>s.map(M=>`"${(C[M]||"").toString().replace(/"/g,'""')}"`).join(","))].join(`
`),l=new Blob([a],{type:"text/csv"}),g=URL.createObjectURL(l),F=document.createElement("a");F.href=g,F.download="clients.csv",F.click()},vs=()=>{if(!je.amount){alert("Please enter an amount");return}W([...h,{...je,id:Date.now(),amount:parseFloat(je.amount)}]),ze({date:new Date().toISOString().split("T")[0],amount:"",store:"",notes:""})},Ns=s=>{window.confirm("Delete this bill?")&&W(h.filter(a=>a.id!==s))},ks=.11,Et=s=>{const a=new Date(s);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`},De=s=>{const a=parseFloat(s.planPrice)||0,l=s.pickup?0:parseFloat(s.serviceFee)||0,g=a+l,F=s.prepayDiscount?g*.1:0,C=g-F,M=C*ks;return{basePlan:a,serviceFee:l,discount:F,tax:M,total:C+M}},Ie=(s,a)=>h.filter(l=>l.date>=s&&l.date<=a).reduce((l,g)=>l+(parseFloat(g.amount)||0),0),Mt=(s,a,l)=>Q.filter(g=>g.clientName===s&&g.date>=a&&g.date<=l).reduce((g,F)=>{const C=n.find(M=>M.name===s);return g+((C==null?void 0:C.persons)||1)},0),At=(s,a)=>n.filter(g=>!g.paysOwnGroceries&&g.status==="active").reduce((g,F)=>{const C=Q.filter(M=>M.clientName===F.name&&M.date>=s&&M.date<=a);return g+C.length*(F.portions||F.persons||1)},0),It=(s,a,l)=>{const g=n.find(Z=>Z.name===s);if(!g||g.paysOwnGroceries)return 0;const F=Ie(a,l),C=At(a,l);if(C===0)return 0;const M=Mt(s,a,l);return F/C*M};if(!O)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:"#f9f9ed"},children:e.jsxs("div",{className:"text-center",children:[e.jsx(as,{size:48,className:"mx-auto mb-4 animate-pulse",style:{color:"#ffd700"}}),e.jsx("p",{className:"text-gray-600",children:"Loading..."})]})});const Qe=Qs(),Ot=us(),Rt=Vs(),Wt=Ys(),Lt=hs();return Js(),e.jsxs("div",{className:"min-h-screen",style:{backgroundColor:"#f9f9ed"},children:[e.jsx("header",{className:"text-white p-4",style:{backgroundColor:"#3d59ab"},children:e.jsxs("div",{className:"max-w-6xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(as,{size:32,style:{color:"#ffd700"}}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Admin Dashboard"}),e.jsx("p",{className:"text-sm opacity-80",children:"Goldfinch Chef"})]})]}),e.jsxs(ts,{to:"/",className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-white/20 hover:bg-white/30 transition-colors",children:[e.jsx(la,{size:20}),"Back to App"]})]})}),e.jsxs("div",{className:"max-w-6xl mx-auto p-4",children:[e.jsx("div",{className:"flex gap-2 mb-6 overflow-x-auto",children:[{id:"overview",label:"Dashboard",icon:oa},{id:"menu",label:"Menu Planner",icon:Ls},{id:"billing",label:"Billing & Dates",icon:Es},{id:"clients",label:"Clients",icon:$e},{id:"ingredients",label:"Ingredients",icon:$s}].map(s=>e.jsxs("button",{onClick:()=>I(s.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium whitespace-nowrap ${D===s.id?"text-white":"bg-white text-gray-600 hover:bg-gray-50"}`,style:D===s.id?{backgroundColor:"#3d59ab"}:{},children:[e.jsx(s.icon,{size:20}),s.label]},s.id))}),D==="overview"&&e.jsx(ya,{weekStart:Ee,weekEnd:Me,thisWeekDeliveries:Ot,thisWeekCompleted:Rt,renewalsThisWeek:Lt,problemsThisWeek:Wt,autoTasks:Qe,customTasks:X,updateCustomTasks:N,newTask:L,setNewTask:v,addCustomTask:ys,toggleTaskComplete:fs,deleteCustomTask:js,groceryBills:h,newGroceryBill:je,setNewGroceryBill:ze,addGroceryBill:vs,deleteGroceryBill:Ns,menuItems:j,recipes:q,getRecipeCost:bs,clients:n,clientPortalData:$}),D==="menu"&&e.jsx(xa,{menuDate:i,setMenuDate:k,clients:n.filter(s=>s.status==="active"),allClients:n,selectedClients:f,setSelectedClients:b,recipes:q,newMenuItem:se,setNewMenuItem:V,menuItems:j,setMenuItems:R,addMenuItem:ct,clearMenu:dt,deleteMenuItem:it,getOrdersByClient:mt,clientPortalData:$,weeklyTasks:te,weeks:E,selectedWeekId:z,setSelectedWeekId:d,lockWeekAndSnapshot:xe,unlockWeekById:S}),D==="approvals"&&e.jsx(va,{clients:n,menuItems:j,updateMenuItems:R,lockWeekWithSnapshot:xe,weeklyTasks:te,clientPortalData:$,recipes:q}),D==="recipes"&&e.jsx(Jt,{recipes:q,newRecipe:U,setNewRecipe:ue,editingRecipe:de,setEditingRecipe:Y,masterIngredients:K,recipesFileRef:we,findExactMatch:Te,findSimilarIngredients:gs,getRecipeCost:bs,getRecipeCounts:ot,saveRecipe:xt,deleteRecipe:pt,startEditingRecipe:ut,saveEditingRecipe:yt,updateEditingIngredient:ht,addEditingIngredient:gt,removeEditingIngredient:bt,exportRecipesCSV:()=>Xt(q),getUniqueVendors:lt,updateMasterIngredientCost:nt,syncRecipeIngredientsFromMaster:rt}),D==="ingredients"&&e.jsx(pa,{masterIngredients:K,newIngredient:Ce,setNewIngredient:he,editingIngredientId:Le,editingIngredientData:is,setEditingIngredientData:Be,duplicateWarnings:ds,setDuplicateWarnings:Ke,scanForDuplicates:Ct,mergeIngredients:wt,addMasterIngredient:ft,deleteMasterIngredient:jt,startEditingMasterIngredient:vt,saveEditingMasterIngredient:Nt,cancelEditingMasterIngredient:kt,ingredientsFileRef:Hs,exportIngredientsCSV:()=>Qt(K)}),D==="clients"&&e.jsx(ua,{clients:n,newClient:Je,setNewClient:ps,addClient:Tt,deleteClient:$t,clientsFileRef:ms,exportClientsCSV:zt,setClients:A}),D==="billing"&&e.jsx(fa,{clients:n,updateClients:A,blockedDates:P,updateBlockedDates:ce}),D==="subscriptions"&&e.jsx(ma,{clients:n,weeklyTasks:te,setWeeklyTasks:p,clientPortalData:$}),D==="groceries"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-2",style:{color:"#3d59ab"},children:[e.jsx(Us,{size:24,className:"inline mr-2"}),"Grocery Tracking"]}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Track weekly grocery expenses for cost analysis."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4 p-4 rounded-lg",style:{backgroundColor:"#f9f9ed"},children:[e.jsx(ge,{label:"Date",children:e.jsx("input",{type:"date",value:je.date,onChange:s=>ze({...je,date:s.target.value}),className:be,style:ye})}),e.jsx(ge,{label:"Amount ($)",children:e.jsx("input",{type:"number",step:"0.01",value:je.amount,onChange:s=>ze({...je,amount:s.target.value}),placeholder:"0.00",className:be,style:ye})}),e.jsx(ge,{label:"Store",children:e.jsx("input",{type:"text",value:je.store,onChange:s=>ze({...je,store:s.target.value}),placeholder:"Store name",className:be,style:ye})}),e.jsx(ge,{label:"Notes",children:e.jsx("input",{type:"text",value:je.notes,onChange:s=>ze({...je,notes:s.target.value}),placeholder:"Optional notes",className:be,style:ye})})]}),e.jsxs("button",{onClick:vs,className:"px-6 py-2 rounded-lg text-white",style:{backgroundColor:"#3d59ab"},children:[e.jsx(Ne,{size:20,className:"inline mr-2"}),"Add Bill"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",style:{color:"#3d59ab"},children:["Recent Bills (",h.length,")"]}),h.length>0?e.jsx("div",{className:"space-y-2",children:h.sort((s,a)=>new Date(a.date)-new Date(s.date)).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border-2",style:{borderColor:"#ebb582"},children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"font-bold text-lg",style:{color:"#3d59ab"},children:["$",parseFloat(s.amount).toFixed(2)]}),e.jsx("span",{className:"text-gray-600",children:new Date(s.date+"T12:00:00").toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}),s.store&&e.jsx("span",{className:"text-sm px-2 py-1 rounded bg-gray-100",children:s.store})]}),s.notes&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:s.notes})]}),e.jsx("button",{onClick:()=>Ns(s.id),className:"text-red-600 hover:text-red-800",children:e.jsx(Fe,{size:18})})]},s.id))}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No grocery bills recorded. Add your first bill above."}),h.length>0&&e.jsxs("div",{className:"mt-6 pt-6 border-t-2",style:{borderColor:"#ebb582"},children:[e.jsx("h4",{className:"font-bold mb-3",children:"Monthly Totals"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:(()=>{const s={};return h.forEach(a=>{const l=Et(a.date);s[l]=(s[l]||0)+parseFloat(a.amount)}),Object.entries(s).sort((a,l)=>l[0].localeCompare(a[0])).slice(0,4).map(([a,l])=>e.jsxs("div",{className:"p-3 rounded-lg",style:{backgroundColor:"#f9f9ed"},children:[e.jsx("p",{className:"text-sm text-gray-500",children:new Date(a+"-01").toLocaleDateString("en-US",{month:"long",year:"numeric"})}),e.jsxs("p",{className:"font-bold text-lg",style:{color:"#3d59ab"},children:["$",l.toFixed(2)]})]},a))})()})]})]})]}),D==="analytics"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-2",style:{color:"#3d59ab"},children:[e.jsx(qs,{size:24,className:"inline mr-2"}),"Analytics Dashboard"]}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["Revenue, costs, and margins at a glance. Tax rate: ",(ks*100).toFixed(0),"%"]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"#3d59ab"},children:"This Week"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:(()=>{const s=Ee.toISOString().split("T")[0],a=Me.toISOString().split("T")[0],l=Ie(s,a),g=n.filter(M=>M.status==="active"),F=g.reduce((M,Z)=>M+De(Z).total,0),C=F-l;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"#dbeafe"},children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Active Clients"}),e.jsx("p",{className:"text-2xl font-bold",style:{color:"#3d59ab"},children:g.length})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"#dcfce7"},children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Weekly Revenue"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["$",F.toFixed(2)]})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"#fef3c7"},children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Weekly Groceries"}),e.jsxs("p",{className:"text-2xl font-bold text-amber-600",children:["$",l.toFixed(2)]})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:C>=0?"#dcfce7":"#fee2e2"},children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Weekly Margin"}),e.jsxs("p",{className:`text-2xl font-bold ${C>=0?"text-green-600":"text-red-600"}`,children:["$",C.toFixed(2)]})]})]})})()})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"#3d59ab"},children:"This Month"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:(()=>{const s=new Date(me.getFullYear(),me.getMonth(),1),a=new Date(me.getFullYear(),me.getMonth()+1,0),l=s.toISOString().split("T")[0],g=a.toISOString().split("T")[0],F=Ie(l,g),M=n.filter(Pe=>Pe.status==="active").reduce((Pe,ee)=>{const ve=De(ee).total,es=ee.frequency==="biweekly"?2:4;return Pe+ve*es},0),Z=M-F,Se=M>0?Z/M*100:0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"#dcfce7"},children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Monthly Revenue (Est.)"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["$",M.toFixed(2)]})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"#fef3c7"},children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Monthly Groceries"}),e.jsxs("p",{className:"text-2xl font-bold text-amber-600",children:["$",F.toFixed(2)]})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:Z>=0?"#dcfce7":"#fee2e2"},children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Monthly Profit"}),e.jsxs("p",{className:`text-2xl font-bold ${Z>=0?"text-green-600":"text-red-600"}`,children:["$",Z.toFixed(2)]})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"#ede9fe"},children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Profit Margin"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:[Se.toFixed(1),"%"]})]})]})})()})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",style:{color:"#3d59ab"},children:[e.jsx($e,{size:20,className:"inline mr-2"}),"Per-Client Analysis"]}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Revenue breakdown and food cost allocation per client."}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2",style:{borderColor:"#ebb582"},children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Client"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Plan"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Service"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Discount"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Tax"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Total"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Food Cost"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Margin"})]})}),e.jsx("tbody",{children:n.filter(s=>s.status==="active").sort((s,a)=>(a.planPrice||0)-(s.planPrice||0)).map((s,a)=>{const l=De(s),g=new Date(me.getFullYear(),me.getMonth(),1).toISOString().split("T")[0],F=new Date(me.getFullYear(),me.getMonth()+1,0).toISOString().split("T")[0],C=It(s.name,g,F),M=l.total-C,Z=l.total>0?M/l.total*100:0;return e.jsxs("tr",{className:"border-b hover:bg-gray-50",style:{borderColor:"#f0f0f0"},children:[e.jsxs("td",{className:"py-2 px-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.displayName||s.name}),s.paysOwnGroceries&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-blue-100 text-blue-700",children:"Own Groceries"}),s.prepayDiscount&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-green-100 text-green-700",children:"Prepay"})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.portions||s.persons||1," portions • ",s.frequency]})]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:["$",l.basePlan.toFixed(2)]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:["$",l.serviceFee.toFixed(2)]}),e.jsx("td",{className:"py-2 px-3 text-right text-green-600",children:l.discount>0?`-$${l.discount.toFixed(2)}`:"-"}),e.jsxs("td",{className:"py-2 px-3 text-right text-gray-500",children:["$",l.tax.toFixed(2)]}),e.jsxs("td",{className:"py-2 px-3 text-right font-bold",children:["$",l.total.toFixed(2)]}),e.jsx("td",{className:"py-2 px-3 text-right text-amber-600",children:s.paysOwnGroceries?"-":`$${C.toFixed(2)}`}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[e.jsxs("span",{className:`font-bold ${M>=0?"text-green-600":"text-red-600"}`,children:["$",M.toFixed(2)]}),e.jsxs("span",{className:"text-xs text-gray-400 ml-1",children:["(",Z.toFixed(0),"%)"]})]})]},s.id||a)})}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 font-bold",style:{borderColor:"#ebb582"},children:[e.jsxs("td",{className:"py-2 px-3",children:["Total (",n.filter(s=>s.status==="active").length," active)"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:["$",n.filter(s=>s.status==="active").reduce((s,a)=>s+De(a).basePlan,0).toFixed(2)]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:["$",n.filter(s=>s.status==="active").reduce((s,a)=>s+De(a).serviceFee,0).toFixed(2)]}),e.jsxs("td",{className:"py-2 px-3 text-right text-green-600",children:["-$",n.filter(s=>s.status==="active").reduce((s,a)=>s+De(a).discount,0).toFixed(2)]}),e.jsxs("td",{className:"py-2 px-3 text-right text-gray-500",children:["$",n.filter(s=>s.status==="active").reduce((s,a)=>s+De(a).tax,0).toFixed(2)]}),e.jsxs("td",{className:"py-2 px-3 text-right",style:{color:"#3d59ab"},children:["$",n.filter(s=>s.status==="active").reduce((s,a)=>s+De(a).total,0).toFixed(2)]}),e.jsx("td",{className:"py-2 px-3 text-right text-amber-600",children:(()=>{const s=new Date(me.getFullYear(),me.getMonth(),1).toISOString().split("T")[0],a=new Date(me.getFullYear(),me.getMonth()+1,0).toISOString().split("T")[0];return`$${Ie(s,a).toFixed(2)}`})()}),e.jsx("td",{className:"py-2 px-3 text-right",children:(()=>{const s=new Date(me.getFullYear(),me.getMonth(),1).toISOString().split("T")[0],a=new Date(me.getFullYear(),me.getMonth()+1,0).toISOString().split("T")[0],l=n.filter(C=>C.status==="active").reduce((C,M)=>C+De(M).total,0),g=Ie(s,a),F=l-g;return e.jsxs("span",{className:F>=0?"text-green-600":"text-red-600",children:["$",F.toFixed(2)]})})()})]})})]})})]})]}),D==="tasks"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",style:{color:"#3d59ab"},children:"Weekly Tasks"}),Qe.length>0?e.jsx("div",{className:"space-y-4",children:Qe.map(s=>e.jsxs("div",{className:`border-l-4 p-4 rounded-r-lg ${s.action?"cursor-pointer hover:shadow-md transition-shadow":""}`,style:{borderColor:s.color,backgroundColor:"#f9f9ed"},onClick:()=>s.action&&I(s.action),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(s.icon,{size:20,style:{color:s.color}}),e.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded",style:{backgroundColor:s.color+"20",color:s.color},children:s.category})]}),s.action&&e.jsx("span",{className:"text-xs px-2 py-1 rounded bg-gray-200 text-gray-600",children:"Click to add →"})]}),e.jsx("h4",{className:"font-bold mb-2",children:s.title}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[s.details.slice(0,5).map((a,l)=>e.jsxs("li",{children:["• ",a]},l)),s.details.length>5&&e.jsxs("li",{className:"text-gray-400",children:["...and ",s.details.length-5," more"]})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(pe,{size:48,className:"mx-auto mb-4 text-green-500"}),e.jsx("p",{children:"All caught up! No pending tasks this week."})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:"#3d59ab"},children:"Custom Tasks"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 p-4 rounded-lg",style:{backgroundColor:"#f9f9ed"},children:[e.jsx(ge,{label:"Task Title",children:e.jsx("input",{type:"text",value:L.title,onChange:s=>v({...L,title:s.target.value}),placeholder:"Enter task title",className:be,style:ye})}),e.jsx(ge,{label:"Notes (optional)",children:e.jsx("input",{type:"text",value:L.notes,onChange:s=>v({...L,notes:s.target.value}),placeholder:"Additional notes",className:be,style:ye})}),e.jsx(ge,{label:"Due Date (optional)",children:e.jsx("input",{type:"date",value:L.dueDate,onChange:s=>v({...L,dueDate:s.target.value}),className:be,style:ye})})]}),e.jsxs("button",{onClick:ys,className:"px-6 py-2 rounded-lg text-white mb-6",style:{backgroundColor:"#3d59ab"},children:[e.jsx(Ne,{size:20,className:"inline mr-2"}),"Add Task"]}),X.length>0?e.jsx("div",{className:"space-y-2",children:X.map(s=>e.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg border-2 ${s.completed?"bg-gray-50 border-gray-200":"border-gray-200"}`,children:[e.jsx("button",{onClick:()=>fs(s.id),className:`w-6 h-6 rounded-full border-2 flex items-center justify-center flex-shrink-0 ${s.completed?"bg-green-500 border-green-500":"border-gray-300"}`,children:s.completed&&e.jsx(pe,{size:14,className:"text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`font-medium ${s.completed?"line-through text-gray-400":""}`,children:s.title}),s.notes&&e.jsx("p",{className:"text-sm text-gray-500",children:s.notes}),s.dueDate&&e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Due: ",Ae(s.dueDate)]})]}),e.jsx("button",{onClick:()=>js(s.id),className:"text-red-500 hover:text-red-700",children:e.jsx(Fe,{size:18})})]},s.id))}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No custom tasks. Add one above."})]})]}),D==="settings"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-4",style:{color:"#3d59ab"},children:[e.jsx(_e,{size:24,className:"inline mr-2"}),"Availability Calendar"]}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Click dates to block them from client date selection."}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:Pt,className:"p-2 hover:bg-gray-100 rounded",children:e.jsx(Rs,{size:24})}),e.jsx("h3",{className:"text-lg font-bold",children:c.toLocaleDateString("en-US",{month:"long",year:"numeric"})}),e.jsx("button",{onClick:Ft,className:"p-2 hover:bg-gray-100 rounded",children:e.jsx(Ws,{size:24})})]}),e.jsxs("div",{className:"grid grid-cols-7 gap-1 mb-4",children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(s=>e.jsx("div",{className:"text-center text-sm font-medium text-gray-500 py-2",children:s},s)),Dt(c).map((s,a)=>{if(!s)return e.jsx("div",{},`empty-${a}`);const l=s.toISOString().split("T")[0],g=P.includes(l),F=s<new Date(me.toISOString().split("T")[0]),C=l===me.toISOString().split("T")[0];return e.jsx("button",{onClick:()=>!F&&St(s),disabled:F,className:`p-2 rounded-lg text-center transition-colors ${F?"text-gray-300 cursor-not-allowed":g?"bg-red-500 text-white hover:bg-red-600":C?"bg-blue-100 hover:bg-blue-200":"hover:bg-gray-100"}`,children:s.getDate()},l)})]}),P.length>0&&e.jsxs("div",{className:"p-3 rounded-lg bg-red-50 border border-red-200",children:[e.jsxs("p",{className:"text-sm font-medium text-red-700 mb-2",children:[P.length," date",P.length>1?"s":""," blocked:"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:P.sort().map(s=>e.jsxs("span",{className:"text-xs px-2 py-1 rounded bg-red-100 text-red-700 flex items-center gap-1",children:[Ae(s),e.jsx("button",{onClick:()=>ce(P.filter(a=>a!==s)),children:e.jsx(fe,{size:12})})]},s))})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-4",style:{color:"#3d59ab"},children:[e.jsx(Yt,{size:24,className:"inline mr-2"}),"Route Starting Address"]}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Set the starting address for delivery route optimization."}),e.jsx(ge,{label:"Starting Address",children:e.jsx("input",{type:"text",value:H.routeStartAddress,onChange:s=>ae({...H,routeStartAddress:s.target.value}),placeholder:"Enter your starting address",className:`${be} w-full`,style:ye})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-4",style:{color:"#3d59ab"},children:[e.jsx($e,{size:24,className:"inline mr-2"}),"Drivers"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4 p-4 rounded-lg",style:{backgroundColor:"#f9f9ed"},children:[e.jsx(ge,{label:"Driver Name",children:e.jsx("input",{type:"text",value:y.name,onChange:s=>J({...y,name:s.target.value}),placeholder:"Enter driver name",className:be,style:ye})}),e.jsx(ge,{label:"Phone",children:e.jsx("input",{type:"tel",value:y.phone,onChange:s=>J({...y,phone:s.target.value}),placeholder:"Phone number",className:be,style:ye})}),e.jsx(ge,{label:"Zone",children:e.jsxs("select",{value:y.zone,onChange:s=>J({...y,zone:s.target.value}),className:be,style:ye,children:[e.jsx("option",{value:"",children:"Unassigned"}),He.map(s=>e.jsxs("option",{value:s,children:["Zone ",s]},s))]})}),e.jsx(ge,{label:"Access Code",children:e.jsx("input",{type:"text",value:y.accessCode,onChange:s=>J({...y,accessCode:s.target.value}),placeholder:"Access code",className:be,style:ye})})]}),e.jsxs("button",{onClick:et,className:"px-6 py-2 rounded-lg text-white mb-6",style:{backgroundColor:"#3d59ab"},children:[e.jsx(Ne,{size:20,className:"inline mr-2"}),"Add Driver"]}),x.length>0?e.jsx("div",{className:"space-y-3",children:x.map((s,a)=>e.jsx("div",{children:t===a?e.jsxs("div",{className:"border-2 rounded-lg p-4",style:{borderColor:"#3d59ab",backgroundColor:"#f9f9ed"},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(ge,{label:"Driver Name",children:e.jsx("input",{type:"text",value:o.name,onChange:l=>u({...o,name:l.target.value}),className:be,style:ye})}),e.jsx(ge,{label:"Phone",children:e.jsx("input",{type:"tel",value:o.phone||"",onChange:l=>u({...o,phone:l.target.value}),className:be,style:ye})}),e.jsx(ge,{label:"Zone",children:e.jsxs("select",{value:o.zone||"",onChange:l=>u({...o,zone:l.target.value}),className:be,style:ye,children:[e.jsx("option",{value:"",children:"Unassigned"}),He.map(l=>e.jsxs("option",{value:l,children:["Zone ",l]},l))]})}),e.jsx(ge,{label:"Access Code",children:e.jsx("input",{type:"text",value:o.accessCode||"",onChange:l=>u({...o,accessCode:l.target.value}),className:be,style:ye})})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs("button",{onClick:at,className:"flex items-center gap-1 px-4 py-2 rounded-lg text-white",style:{backgroundColor:"#3d59ab"},children:[e.jsx(pe,{size:18}),"Save"]}),e.jsxs("button",{onClick:()=>{r(null),u(null)},className:"flex items-center gap-1 px-4 py-2 rounded-lg bg-gray-200",children:[e.jsx(fe,{size:18}),"Cancel"]})]})]}):e.jsxs("div",{className:"border-2 rounded-lg p-4",style:{borderColor:"#ebb582"},children:[e.jsxs("div",{className:"flex justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h3",{className:"font-bold text-lg",children:s.name}),s.zone&&e.jsxs("span",{className:"text-xs px-2 py-1 rounded bg-purple-100 text-purple-700",children:["Zone ",s.zone]})]}),s.phone&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Phone: ",s.phone]})]}),e.jsxs("div",{className:"flex gap-2 self-start ml-4",children:[e.jsx("button",{onClick:()=>tt(a),className:"text-blue-600",children:e.jsx(We,{size:18})}),e.jsx("button",{onClick:()=>st(a),className:"text-red-600",children:e.jsx(Fe,{size:18})})]})]}),s.accessCode&&e.jsxs("div",{className:"mb-3 p-3 rounded-lg",style:{backgroundColor:"#f9f9ed"},children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Access Code"}),e.jsx("p",{className:"font-mono font-bold text-lg",style:{color:"#3d59ab"},children:s.accessCode})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:()=>window.open(`/driver?admin_driver=${encodeURIComponent(s.name)}`,"_blank"),className:"flex items-center gap-2 px-3 py-2 rounded-lg text-white text-sm",style:{backgroundColor:"#3d59ab"},children:[e.jsx(ns,{size:16}),"Preview Driver View"]}),e.jsxs("button",{onClick:()=>{const l=`${window.location.origin}/driver`;navigator.clipboard.writeText(l),alert("Driver login link copied to clipboard!")},className:"flex items-center gap-2 px-3 py-2 rounded-lg border-2 text-sm",style:{borderColor:"#ebb582"},children:[e.jsx(ra,{size:16}),"Copy Login Link"]})]})]})},s.id||a))}):e.jsx("p",{className:"text-gray-500",children:"No drivers yet. Add your first driver above."})]})]})]}),xs&&e.jsx(ha,{client:xs,clientPortalData:$,onSave:s=>{const a=n.findIndex(l=>l.subscriptionId===s.subscriptionId||l.name===s.name||l.displayName===s.displayName);if(a>=0){const l=[...n];l[a]={...l[a],...s},A(l)}},onClose:()=>_s(null)}),e.jsx("input",{type:"file",ref:ms,accept:".csv",style:{display:"none"},onChange:s=>{var l;const a=(l=s.target.files)==null?void 0:l[0];a&&(ea(a,g=>{if(g.length===0){alert(`No subscriptions found in CSV. Please check the file format.

Expected columns: Name, Display Name, Address, Email, Phone, Portions, Meals, etc.`);return}const F=g.reduce((C,M)=>{var Z;return C+(((Z=M.contacts)==null?void 0:Z.length)||0)},0);A(g),alert(`Import successful!

${g.length} subscription(s) imported
${F} contact(s) total`)},g=>alert("Error parsing CSV: "+(g.message||g))),s.target.value="")}})]})}export{Fa as default};
